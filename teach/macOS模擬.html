<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>macOS Simulation - 繁體中文</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap');

        :root {
            --mac-bg-color: #000000;
            --dock-bg: rgba(255, 255, 255, 0.2);
            --window-bg: rgba(30, 30, 30, 0.85);
            --text-primary: #ffffff;
            --system-blue: #0A84FF;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "PingFang TC", "Noto Sans TC", "Helvetica Neue", sans-serif;
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #000;
            user-select: none;
            -webkit-user-select: none;
        }

        /* Scrollbar Customization */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: transparent;
        }
        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.5);
        }

        /* Animations */
        @keyframes bootUp {
            0% { opacity: 0; transform: scale(0.95); }
            100% { opacity: 1; transform: scale(1); }
        }
        
        @keyframes loadingBar {
            0% { width: 0%; }
            20% { width: 10%; }
            50% { width: 40%; }
            80% { width: 80%; }
            100% { width: 100%; }
        }

        @keyframes popIn {
            0% { transform: scale(0.9); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        .window-transition {
            transition: transform 0.15s cubic-bezier(0.2, 0, 0, 1), opacity 0.15s ease, width 0.2s ease, height 0.2s ease;
        }

        .dock-icon {
            transition: transform 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        
        .dock-icon:hover {
            transform: scale(1.2) translateY(-10px);
        }

        .glass {
            background: rgba(40, 40, 40, 0.65);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .menu-glass {
            background: rgba(40, 40, 40, 0.8);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
        }

        /* App Icon Styles (Pure CSS/SVG approximation) */
        .app-icon-finder { background: linear-gradient(180deg, #1c8aff 0%, #0050d5 100%); }
        .app-icon-safari { background: white; }
        .app-icon-messages { background: #4CD964; }
        .app-icon-mail { background: linear-gradient(180deg, #5caaff 0%, #2b7cff 100%); }
        .app-icon-photos { background: white; }
        .app-icon-settings { background: linear-gradient(135deg, #a0a0a0 0%, #505050 100%); }
        .app-icon-terminal { background: #222; border: 1px solid #444; }
        .app-icon-notes { background: linear-gradient(180deg, #ffeba3 0%, #f5d763 100%); }
        .app-icon-calculator { background: #333; }
        
        /* Wallpaper Variants */
        .bg-sonoma { background: url('https://images.unsplash.com/photo-1696349245449-30c6f555f9b2?q=80&w=2560&auto=format&fit=crop') center/cover no-repeat; }
        .bg-ventura { background: url('https://images.unsplash.com/photo-1666626729512-145063575c0d?q=80&w=2560&auto=format&fit=crop') center/cover no-repeat; }
        .bg-monterey { background: url('https://images.unsplash.com/photo-1635241533061-c4482144c453?q=80&w=2560&auto=format&fit=crop') center/cover no-repeat; }
        
        .traffic-light {
            width: 12px; height: 12px; border-radius: 50%; display: inline-block; margin-right: 6px;
            position: relative;
        }
        .traffic-close { background-color: #ff5f57; border: 1px solid #e0443e; }
        .traffic-min { background-color: #febc2e; border: 1px solid #d89e24; }
        .traffic-max { background-color: #28c840; border: 1px solid #1aab29; }
        
        .traffic-light:hover::after {
            content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            display: flex; align-items: center; justify-content: center;
            font-family: "Font Awesome 6 Free"; font-weight: 900; font-size: 8px; color: rgba(0,0,0,0.5);
        }
        .traffic-close:hover::after { content: '\f00d'; }
        .traffic-min:hover::after { content: '\f2d1'; }
        .traffic-max:hover::after { content: '\f065'; }

        /* CRT/Terminal Effect */
        .terminal-text {
            font-family: 'Menlo', 'Monaco', 'Courier New', monospace;
        }
        
        /* Cursor */
        .cursor-default { cursor: default; }
        .cursor-pointer { cursor: pointer; }
    </style>
</head>
<body class="text-white overflow-hidden h-screen w-screen selection:bg-blue-500 selection:text-white">

    <!-- 1. Boot Screen -->
    <div id="boot-screen" class="fixed inset-0 bg-black z-50 flex flex-col items-center justify-center h-full w-full">
        <i class="fa-brands fa-apple text-white text-8xl mb-10"></i>
        <div class="w-48 h-1.5 bg-gray-800 rounded-full overflow-hidden">
            <div id="boot-progress" class="h-full bg-white rounded-full w-0"></div>
        </div>
    </div>

    <!-- 2. Login Screen -->
    <div id="login-screen" class="fixed inset-0 z-40 hidden bg-sonoma flex flex-col items-center justify-center transition-opacity duration-1000">
        <div class="absolute inset-0 backdrop-blur-xl bg-black/20"></div>
        <div class="relative z-10 flex flex-col items-center animate-[popIn_0.5s_ease-out]">
            <div class="w-24 h-24 rounded-full overflow-hidden shadow-2xl mb-4 border-2 border-white/20">
                <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Felix" alt="User" class="w-full h-full bg-gray-300 object-cover">
            </div>
            <h2 class="text-2xl font-semibold text-white mb-4 drop-shadow-md">使用者</h2>
            <div class="flex flex-col items-center gap-2">
                <input type="password" id="password-input" placeholder="輸入密碼" 
                    class="bg-white/20 backdrop-blur-md border border-white/10 text-white px-4 py-1.5 rounded-full outline-none focus:bg-white/30 text-center placeholder-gray-300 w-48 transition-all">
                <p class="text-xs text-gray-300 mt-2 cursor-pointer hover:text-white">點擊或按下 Enter 登入</p>
            </div>
        </div>
        <div class="absolute bottom-10 flex flex-col items-center">
             <div class="flex gap-4 mb-4">
                <div class="w-10 h-10 rounded-full bg-gray-500/30 flex items-center justify-center backdrop-blur-md hover:bg-gray-500/50 transition cursor-pointer">
                    <i class="fa-solid fa-wifi text-white"></i>
                </div>
                <div class="w-10 h-10 rounded-full bg-gray-500/30 flex items-center justify-center backdrop-blur-md hover:bg-gray-500/50 transition cursor-pointer">
                    <i class="fa-solid fa-universal-access text-white"></i>
                </div>
                <div class="w-10 h-10 rounded-full bg-gray-500/30 flex items-center justify-center backdrop-blur-md hover:bg-gray-500/50 transition cursor-pointer">
                    <i class="fa-solid fa-power-off text-white"></i>
                </div>
             </div>
        </div>
    </div>

    <!-- 3. Desktop Environment -->
    <div id="desktop" class="fixed inset-0 hidden bg-sonoma bg-cover bg-center transition-all duration-500">
        
        <!-- Menu Bar -->
        <div class="h-8 bg-black/20 backdrop-blur-xl flex items-center justify-between px-4 text-sm font-medium select-none z-30 fixed top-0 w-full shadow-sm">
            <div class="flex items-center gap-4 h-full">
                <div class="relative group">
                    <i class="fa-brands fa-apple text-lg cursor-pointer hover:text-gray-200"></i>
                    <!-- Apple Dropdown -->
                    <div class="hidden group-hover:block absolute top-6 left-0 w-56 glass rounded-lg p-1 text-white/90 shadow-xl">
                        <div class="px-3 py-1 hover:bg-blue-600 rounded cursor-pointer" onclick="openWindow('about')">關於這台 Mac</div>
                        <div class="h-[1px] bg-white/10 my-1"></div>
                        <div class="px-3 py-1 hover:bg-blue-600 rounded cursor-pointer" onclick="openWindow('settings')">系統設定...</div>
                        <div class="px-3 py-1 hover:bg-blue-600 rounded cursor-pointer">App Store...</div>
                        <div class="h-[1px] bg-white/10 my-1"></div>
                        <div class="px-3 py-1 hover:bg-blue-600 rounded cursor-pointer">強制結束...</div>
                        <div class="h-[1px] bg-white/10 my-1"></div>
                        <div class="px-3 py-1 hover:bg-blue-600 rounded cursor-pointer">睡眠</div>
                        <div class="px-3 py-1 hover:bg-blue-600 rounded cursor-pointer" onclick="location.reload()">重新啟動...</div>
                        <div class="px-3 py-1 hover:bg-blue-600 rounded cursor-pointer" onclick="location.reload()">關機...</div>
                        <div class="h-[1px] bg-white/10 my-1"></div>
                        <div class="px-3 py-1 hover:bg-blue-600 rounded cursor-pointer" onclick="lockScreen()">鎖定螢幕</div>
                    </div>
                </div>
                <span class="font-bold cursor-pointer" id="active-app-name">Finder</span>
                <span class="cursor-pointer hidden md:inline hover:text-gray-300">檔案</span>
                <span class="cursor-pointer hidden md:inline hover:text-gray-300">編輯</span>
                <span class="cursor-pointer hidden md:inline hover:text-gray-300">顯示方式</span>
                <span class="cursor-pointer hidden md:inline hover:text-gray-300">前往</span>
                <span class="cursor-pointer hidden md:inline hover:text-gray-300">視窗</span>
                <span class="cursor-pointer hidden md:inline hover:text-gray-300">說明</span>
            </div>
            <div class="flex items-center gap-4 h-full">
                <i class="fa-brands fa-bluetooth-b cursor-pointer hover:text-gray-300 hidden sm:block"></i>
                <i class="fa-solid fa-wifi cursor-pointer hover:text-gray-300 hidden sm:block"></i>
                <i class="fa-solid fa-battery-three-quarters cursor-pointer hover:text-gray-300 hidden sm:block"></i>
                <i class="fa-solid fa-magnifying-glass cursor-pointer hover:text-gray-300" onclick="openSpotlight()"></i>
                <div class="cursor-pointer hover:bg-white/10 px-2 rounded transition h-full flex items-center" onclick="toggleControlCenter()">
                    <i class="fa-solid fa-sliders text-base"></i>
                </div>
                <div id="clock" class="cursor-pointer hover:bg-white/10 px-2 rounded transition h-full flex items-center">
                    11月21日 週五 上午 11:38
                </div>
            </div>
        </div>

        <!-- Desktop Icons -->
        <div class="absolute top-10 right-4 flex flex-col gap-6 items-end p-2 z-0">
            <div class="group flex flex-col items-center gap-1 w-20 cursor-pointer" onclick="openWindow('finder')">
                <div class="w-16 h-16 rounded bg-blue-500/20 border border-white/20 backdrop-blur flex items-center justify-center group-hover:bg-blue-500/40 transition relative">
                    <i class="fa-solid fa-hard-drive text-4xl text-gray-200"></i>
                </div>
                <span class="text-xs font-medium shadow-black drop-shadow-md bg-black/30 px-2 py-0.5 rounded-full">Macintosh HD</span>
            </div>
             <div class="group flex flex-col items-center gap-1 w-20 cursor-pointer">
                <div class="w-16 h-16 rounded flex items-center justify-center transition relative">
                    <i class="fa-regular fa-folder text-6xl text-blue-400 drop-shadow-lg"></i>
                </div>
                <span class="text-xs font-medium shadow-black drop-shadow-md bg-black/30 px-2 py-0.5 rounded-full">未命名檔案夾</span>
            </div>
        </div>

        <!-- Windows Container -->
        <div id="windows-area" class="absolute inset-0 top-8 bottom-20 pointer-events-none overflow-hidden">
            <!-- Windows will be injected here via JS -->
        </div>

        <!-- Control Center -->
        <div id="control-center" class="absolute top-10 right-2 w-80 glass rounded-2xl p-3 hidden transition-all z-50 transform scale-95 opacity-0 origin-top-right">
            <div class="grid grid-cols-2 gap-3 mb-3">
                <div class="bg-black/20 rounded-xl p-3 flex flex-col gap-3">
                    <div class="flex gap-3 items-center">
                        <div class="w-8 h-8 rounded-full bg-blue-500 flex items-center justify-center text-white"><i class="fa-solid fa-wifi"></i></div>
                        <div class="flex flex-col">
                            <span class="text-xs font-bold">Wi-Fi</span>
                            <span class="text-[10px] text-gray-300">Home_5G</span>
                        </div>
                    </div>
                    <div class="flex gap-3 items-center">
                         <div class="w-8 h-8 rounded-full bg-blue-500 flex items-center justify-center text-white"><i class="fa-brands fa-bluetooth-b"></i></div>
                         <div class="flex flex-col">
                            <span class="text-xs font-bold">藍牙</span>
                            <span class="text-[10px] text-gray-300">開啟</span>
                        </div>
                    </div>
                    <div class="flex gap-3 items-center">
                         <div class="w-8 h-8 rounded-full bg-blue-500 flex items-center justify-center text-white"><i class="fa-solid fa-broadcast-tower"></i></div>
                         <div class="flex flex-col">
                            <span class="text-xs font-bold">AirDrop</span>
                            <span class="text-[10px] text-gray-300">只限聯絡人</span>
                        </div>
                    </div>
                </div>
                <div class="flex flex-col gap-3">
                    <div class="bg-black/20 rounded-xl p-3 flex items-center gap-3 h-full cursor-pointer hover:bg-black/30">
                         <div class="w-8 h-8 rounded-full bg-gray-600 flex items-center justify-center text-white"><i class="fa-solid fa-moon"></i></div>
                         <span class="text-xs font-bold">勿擾模式</span>
                    </div>
                     <div class="bg-black/20 rounded-xl p-3 flex items-center gap-3 h-full cursor-pointer hover:bg-black/30" onclick="changeWallpaper()">
                         <div class="w-8 h-8 rounded-full bg-gray-600 flex items-center justify-center text-white"><i class="fa-regular fa-image"></i></div>
                         <span class="text-xs font-bold">切換桌布</span>
                    </div>
                </div>
            </div>
            <div class="bg-black/20 rounded-xl p-3 mb-3">
                <span class="text-xs font-bold mb-2 block">顯示器</span>
                <input type="range" min="1" max="100" value="80" class="w-full accent-white h-2 bg-white/20 rounded-lg appearance-none cursor-pointer">
            </div>
             <div class="bg-black/20 rounded-xl p-3">
                <span class="text-xs font-bold mb-2 block">聲音</span>
                <input type="range" min="1" max="100" value="50" class="w-full accent-white h-2 bg-white/20 rounded-lg appearance-none cursor-pointer">
            </div>
        </div>

        <!-- Spotlight Search -->
        <div id="spotlight" class="absolute top-[20%] left-1/2 -translate-x-1/2 w-[600px] glass rounded-xl p-4 hidden z-50">
            <div class="flex items-center gap-3 text-xl">
                <i class="fa-solid fa-magnifying-glass text-gray-400"></i>
                <input type="text" placeholder="Spotlight 搜尋" class="bg-transparent outline-none text-white w-full placeholder-gray-500 h-8 text-2xl">
            </div>
        </div>

        <!-- Dock -->
        <div class="fixed bottom-2 left-1/2 -translate-x-1/2 glass rounded-2xl px-3 py-2 flex gap-3 items-end z-40 mb-1 h-[70px]">
            <!-- Finder -->
            <div class="dock-icon w-12 h-12 rounded-xl app-icon-finder relative cursor-pointer flex items-center justify-center" onclick="openWindow('finder')" title="Finder">
                <div class="absolute inset-0 border-2 border-white/20 rounded-xl"></div>
                <div class="w-8 h-8 border-b-2 border-white/90 rounded-b-full mt-1"></div> <!-- Smile -->
                <div class="absolute top-3 left-3 w-1.5 h-4 bg-black/40 rounded-full rotate-12"></div> <!-- Eye L -->
                <div class="absolute top-3 right-3 w-1.5 h-4 bg-black/40 rounded-full -rotate-12"></div> <!-- Eye R -->
                <div class="absolute -bottom-3 w-1 h-1 bg-white rounded-full left-1/2 -translate-x-1/2 opacity-80"></div>
            </div>

            <!-- Safari -->
            <div class="dock-icon w-12 h-12 rounded-xl app-icon-safari relative cursor-pointer overflow-hidden" onclick="openWindow('safari')" title="Safari">
                 <i class="fa-regular fa-compass text-blue-500 text-5xl absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2"></i>
            </div>

            <!-- Terminal -->
            <div class="dock-icon w-12 h-12 rounded-xl app-icon-terminal relative cursor-pointer flex items-center justify-center text-white" onclick="openWindow('terminal')" title="終端機">
                <span class="font-mono text-xs text-green-400 font-bold">$_</span>
            </div>

            <!-- Notes -->
            <div class="dock-icon w-12 h-12 rounded-xl app-icon-notes relative cursor-pointer flex items-center justify-center" onclick="openWindow('notes')" title="備忘錄">
                 <div class="w-8 h-9 bg-white border-t-4 border-gray-300 shadow-sm">
                     <div class="w-full h-1 bg-gray-200 mt-2"></div>
                     <div class="w-full h-1 bg-gray-200 mt-2"></div>
                     <div class="w-2/3 h-1 bg-gray-200 mt-2"></div>
                 </div>
            </div>

            <!-- Calculator -->
            <div class="dock-icon w-12 h-12 rounded-xl app-icon-calculator relative cursor-pointer flex items-center justify-center text-white" onclick="openWindow('calculator')" title="計算機">
                <i class="fa-solid fa-calculator text-2xl"></i>
            </div>

            <!-- Settings -->
            <div class="dock-icon w-12 h-12 rounded-xl app-icon-settings relative cursor-pointer flex items-center justify-center" onclick="openWindow('settings')" title="系統設定">
                <i class="fa-solid fa-gear text-3xl text-gray-300 animate-[spin_10s_linear_infinite]"></i>
            </div>

            <div class="w-[1px] h-10 bg-white/20 mx-1"></div>

            <!-- Trash -->
            <div class="dock-icon w-12 h-12 rounded-xl bg-transparent border border-white/10 relative cursor-pointer flex items-end justify-center pb-1 backdrop-blur-sm hover:bg-white/10" title="垃圾桶">
                <i class="fa-solid fa-trash-can text-3xl text-gray-400 bg-gradient-to-b from-gray-300 to-gray-500 bg-clip-text text-transparent"></i>
            </div>
        </div>
    </div>

    <script>
        /* ---------------------
           System State & Logic 
           --------------------- */
        
        // DOM Elements
        const bootScreen = document.getElementById('boot-screen');
        const bootProgress = document.getElementById('boot-progress');
        const loginScreen = document.getElementById('login-screen');
        const passwordInput = document.getElementById('password-input');
        const desktop = document.getElementById('desktop');
        const windowsArea = document.getElementById('windows-area');
        const clockEl = document.getElementById('clock');
        const activeAppName = document.getElementById('active-app-name');

        let zIndexCounter = 100;
        let activeWindowId = null;
        const backgroundClasses = ['bg-sonoma', 'bg-ventura', 'bg-monterey'];
        let currentBgIndex = 0;

        // --- Boot Sequence ---
        window.onload = () => {
            // Simulate loading bar
            bootProgress.style.animation = 'loadingBar 3s ease-in-out forwards';
            
            setTimeout(() => {
                bootScreen.style.opacity = '0';
                setTimeout(() => {
                    bootScreen.style.display = 'none';
                    loginScreen.style.display = 'flex';
                }, 500);
            }, 3200);
        };

        // --- Login Logic ---
        const doLogin = () => {
            loginScreen.classList.add('opacity-0');
            setTimeout(() => {
                loginScreen.style.display = 'none';
                desktop.style.display = 'block';
                // Play startup sound logic could go here
            }, 800);
        };

        passwordInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') doLogin();
        });
        
        // Re-lock screen
        function lockScreen() {
            desktop.style.display = 'none';
            loginScreen.style.display = 'flex';
            loginScreen.classList.remove('opacity-0');
            passwordInput.value = '';
            // Clear windows? Optional.
        }

        // --- Clock ---
        function updateClock() {
            const now = new Date();
            const days = ['週日', '週一', '週二', '週三', '週四', '週五', '週六'];
            const month = now.getMonth() + 1;
            const date = now.getDate();
            const day = days[now.getDay()];
            let hours = now.getHours();
            const minutes = now.getMinutes().toString().padStart(2, '0');
            const period = hours >= 12 ? '下午' : '上午';
            
            hours = hours % 12;
            hours = hours ? hours : 12;

            clockEl.innerText = `${month}月${date}日 ${day} ${period} ${hours}:${minutes}`;
        }
        setInterval(updateClock, 1000);
        updateClock();

        // --- Window Management System ---
        
        const apps = {
            finder: {
                title: 'Finder',
                width: 800,
                height: 500,
                content: `
                    <div class="flex h-full text-sm">
                        <div class="w-48 bg-gray-800/50 border-r border-white/10 p-2 flex flex-col gap-1 backdrop-blur-md">
                            <div class="text-xs text-gray-400 px-2 py-1 font-bold mt-2">喜好項目</div>
                            <div class="flex items-center gap-2 px-2 py-1 rounded bg-blue-600/80 text-white cursor-pointer"><i class="fa-solid fa-clock text-blue-300"></i> 最近項目</div>
                            <div class="flex items-center gap-2 px-2 py-1 rounded hover:bg-white/10 cursor-pointer"><i class="fa-solid fa-desktop text-blue-300"></i> 桌面</div>
                            <div class="flex items-center gap-2 px-2 py-1 rounded hover:bg-white/10 cursor-pointer"><i class="fa-regular fa-file text-blue-300"></i> 文件</div>
                            <div class="flex items-center gap-2 px-2 py-1 rounded hover:bg-white/10 cursor-pointer"><i class="fa-solid fa-download text-blue-300"></i> 下載項目</div>
                            <div class="flex items-center gap-2 px-2 py-1 rounded hover:bg-white/10 cursor-pointer"><i class="fa-regular fa-image text-blue-300"></i> 圖片</div>
                            
                            <div class="text-xs text-gray-400 px-2 py-1 font-bold mt-4">iCloud</div>
                            <div class="flex items-center gap-2 px-2 py-1 rounded hover:bg-white/10 cursor-pointer"><i class="fa-solid fa-cloud text-blue-300"></i> iCloud 雲碟</div>
                        </div>
                        <div class="flex-1 bg-black/40 p-4 overflow-y-auto">
                            <div class="grid grid-cols-4 gap-4">
                                <div class="flex flex-col items-center gap-2 p-2 hover:bg-blue-500/30 rounded border border-transparent hover:border-blue-400/30 cursor-pointer">
                                    <i class="fa-regular fa-folder text-5xl text-blue-400"></i>
                                    <span class="text-xs text-center break-all">未命名檔案夾</span>
                                </div>
                                <div class="flex flex-col items-center gap-2 p-2 hover:bg-blue-500/30 rounded border border-transparent hover:border-blue-400/30 cursor-pointer">
                                    <i class="fa-solid fa-file-pdf text-5xl text-red-400"></i>
                                    <span class="text-xs text-center break-all">專案報告.pdf</span>
                                </div>
                                <div class="flex flex-col items-center gap-2 p-2 hover:bg-blue-500/30 rounded border border-transparent hover:border-blue-400/30 cursor-pointer">
                                    <i class="fa-solid fa-file-image text-5xl text-green-400"></i>
                                    <span class="text-xs text-center break-all">螢幕截圖...png</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `
            },
            safari: {
                title: 'Safari',
                width: 900,
                height: 600,
                content: `
                    <div class="flex flex-col h-full bg-white">
                        <div class="bg-gray-100 border-b border-gray-300 p-2 flex items-center gap-4 h-10">
                            <div class="flex gap-2 text-gray-500">
                                <i class="fa-solid fa-chevron-left cursor-pointer hover:text-black"></i>
                                <i class="fa-solid fa-chevron-right cursor-pointer hover:text-black"></i>
                            </div>
                            <div class="flex-1 bg-white border border-gray-300 rounded flex items-center justify-center text-xs h-7 shadow-sm">
                                <i class="fa-solid fa-lock text-[10px] mr-1 text-gray-500"></i> apple.com/tw
                            </div>
                            <i class="fa-solid fa-rotate-right text-gray-500 cursor-pointer hover:text-black"></i>
                        </div>
                        <div class="flex-1 bg-white flex flex-col items-center justify-center text-black">
                            <i class="fa-brands fa-apple text-6xl mb-4"></i>
                            <h1 class="text-3xl font-semibold mb-2">iPhone 16 Pro</h1>
                            <p class="text-xl text-gray-600 mb-6">精彩，驚豔。</p>
                            <button class="bg-blue-600 text-white px-4 py-1 rounded-full text-sm hover:bg-blue-700">進一步了解</button>
                            <div class="mt-12 text-gray-400 text-sm border-t pt-4 w-full text-center">
                                <p>此為模擬頁面，無法瀏覽真實網際網路。</p>
                            </div>
                        </div>
                    </div>
                `
            },
            terminal: {
                title: '終端機 — -zsh',
                width: 600,
                height: 400,
                content: `
                    <div class="bg-[#1e1e1e] h-full p-2 text-white font-mono text-sm overflow-y-auto terminal-window" onclick="document.getElementById('term-input').focus()">
                        <div id="term-output">
                            <p>Last login: ${new Date().toDateString()} on ttys000</p>
                            <p class="mb-2">Welcome to macOS. Type 'help' for commands.</p>
                        </div>
                        <div class="flex">
                            <span class="text-green-400 mr-2">user@MacBook-Pro ~ %</span>
                            <input type="text" id="term-input" class="bg-transparent border-none outline-none text-white flex-1 font-mono" autocomplete="off">
                        </div>
                    </div>
                `
            },
            calculator: {
                title: '計算機',
                width: 280,
                height: 380,
                content: `
                    <div class="bg-[#323232] h-full flex flex-col p-2">
                        <div id="calc-display" class="h-16 text-white text-5xl font-light text-right px-2 mb-2 flex items-center justify-end overflow-hidden">0</div>
                        <div class="grid grid-cols-4 gap-px bg-gray-600/50 p-[1px] rounded flex-1">
                            <!-- Row 1 -->
                            <button onclick="calc('c')" class="bg-[#505050] hover:bg-[#606060] text-white p-3 rounded-sm text-lg">AC</button>
                            <button onclick="calc('n')" class="bg-[#505050] hover:bg-[#606060] text-white p-3 rounded-sm text-lg">+/-</button>
                            <button onclick="calc('%')" class="bg-[#505050] hover:bg-[#606060] text-white p-3 rounded-sm text-lg">%</button>
                            <button onclick="calc('/')" class="bg-[#FF9F0A] hover:bg-[#ffb038] text-white p-3 rounded-sm text-xl">÷</button>
                            <!-- Row 2 -->
                            <button onclick="calc('7')" class="bg-[#686868] hover:bg-[#787878] text-white p-3 rounded-sm text-xl">7</button>
                            <button onclick="calc('8')" class="bg-[#686868] hover:bg-[#787878] text-white p-3 rounded-sm text-xl">8</button>
                            <button onclick="calc('9')" class="bg-[#686868] hover:bg-[#787878] text-white p-3 rounded-sm text-xl">9</button>
                            <button onclick="calc('*')" class="bg-[#FF9F0A] hover:bg-[#ffb038] text-white p-3 rounded-sm text-xl">×</button>
                            <!-- Row 3 -->
                            <button onclick="calc('4')" class="bg-[#686868] hover:bg-[#787878] text-white p-3 rounded-sm text-xl">4</button>
                            <button onclick="calc('5')" class="bg-[#686868] hover:bg-[#787878] text-white p-3 rounded-sm text-xl">5</button>
                            <button onclick="calc('6')" class="bg-[#686868] hover:bg-[#787878] text-white p-3 rounded-sm text-xl">6</button>
                            <button onclick="calc('-')" class="bg-[#FF9F0A] hover:bg-[#ffb038] text-white p-3 rounded-sm text-xl">-</button>
                            <!-- Row 4 -->
                            <button onclick="calc('1')" class="bg-[#686868] hover:bg-[#787878] text-white p-3 rounded-sm text-xl">1</button>
                            <button onclick="calc('2')" class="bg-[#686868] hover:bg-[#787878] text-white p-3 rounded-sm text-xl">2</button>
                            <button onclick="calc('3')" class="bg-[#686868] hover:bg-[#787878] text-white p-3 rounded-sm text-xl">3</button>
                            <button onclick="calc('+')" class="bg-[#FF9F0A] hover:bg-[#ffb038] text-white p-3 rounded-sm text-xl">+</button>
                            <!-- Row 5 -->
                            <button onclick="calc('0')" class="col-span-2 bg-[#686868] hover:bg-[#787878] text-white p-3 rounded-sm text-xl text-left pl-6">0</button>
                            <button onclick="calc('.')" class="bg-[#686868] hover:bg-[#787878] text-white p-3 rounded-sm text-xl">.</button>
                            <button onclick="calc('=')" class="bg-[#FF9F0A] hover:bg-[#ffb038] text-white p-3 rounded-sm text-xl">=</button>
                        </div>
                    </div>
                `
            },
            notes: {
                title: '備忘錄',
                width: 600,
                height: 400,
                content: `
                    <div class="flex h-full bg-[#1e1e1e]">
                        <div class="w-32 border-r border-white/10 p-2 bg-black/20">
                            <div class="p-2 bg-yellow-500/20 text-yellow-400 rounded mb-2 text-sm font-bold">iCloud</div>
                            <div class="text-xs text-gray-400 px-2">所有 iCloud</div>
                            <div class="text-xs text-gray-400 px-2 mt-2">備忘錄</div>
                        </div>
                         <div class="w-40 border-r border-white/10 bg-black/10">
                             <div class="p-3 border-b border-white/5 bg-white/5">
                                 <div class="font-bold text-sm text-white">新的想法</div>
                                 <div class="text-xs text-gray-400">11:38</div>
                             </div>
                        </div>
                        <textarea class="flex-1 bg-[#1e1e1e] text-white p-6 outline-none resize-none font-sans text-base placeholder-gray-500" placeholder="輸入備忘錄..."></textarea>
                    </div>
                `
            },
            settings: {
                title: '系統設定',
                width: 700,
                height: 450,
                content: `
                    <div class="flex h-full text-sm bg-[#282828]">
                        <div class="w-48 bg-[#1e1e1e] p-2 overflow-y-auto border-r border-black">
                            <div class="flex items-center gap-2 p-1 mb-4">
                                <div class="w-10 h-10 rounded-full bg-gray-500 overflow-hidden">
                                    <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Felix" class="w-full h-full bg-white">
                                </div>
                                <div>
                                    <div class="font-bold">使用者</div>
                                    <div class="text-xs text-gray-400">Apple ID</div>
                                </div>
                            </div>
                            <div class="space-y-1">
                                <div class="px-2 py-1 rounded bg-blue-600 text-white">外觀</div>
                                <div class="px-2 py-1 rounded hover:bg-white/10 text-gray-300">Wi-Fi</div>
                                <div class="px-2 py-1 rounded hover:bg-white/10 text-gray-300">藍牙</div>
                                <div class="px-2 py-1 rounded hover:bg-white/10 text-gray-300">一般</div>
                                <div class="px-2 py-1 rounded hover:bg-white/10 text-gray-300">顯示器</div>
                            </div>
                        </div>
                        <div class="flex-1 p-6 overflow-y-auto">
                            <h2 class="text-xl font-bold mb-4">外觀</h2>
                            <div class="flex gap-4 mb-6">
                                <div class="flex flex-col items-center gap-2 cursor-pointer" onclick="alert('已切換至淺色模式 (模擬)')">
                                    <div class="w-20 h-14 bg-[#f5f5f5] rounded-md border border-gray-600"></div>
                                    <span class="text-xs">淺色</span>
                                </div>
                                <div class="flex flex-col items-center gap-2 cursor-pointer">
                                    <div class="w-20 h-14 bg-[#1e1e1e] rounded-md border-2 border-blue-500"></div>
                                    <span class="text-xs">深色</span>
                                </div>
                                <div class="flex flex-col items-center gap-2 cursor-pointer">
                                    <div class="w-20 h-14 bg-gradient-to-r from-[#f5f5f5] to-[#1e1e1e] rounded-md border border-gray-600"></div>
                                    <span class="text-xs">自動</span>
                                </div>
                            </div>
                            
                            <h2 class="text-xl font-bold mb-4 mt-8">桌布</h2>
                             <div class="grid grid-cols-3 gap-4">
                                <div onclick="setWallpaper(0)" class="cursor-pointer aspect-video bg-sonoma bg-cover rounded-lg border hover:border-blue-500 transition"></div>
                                <div onclick="setWallpaper(1)" class="cursor-pointer aspect-video bg-ventura bg-cover rounded-lg border hover:border-blue-500 transition"></div>
                                <div onclick="setWallpaper(2)" class="cursor-pointer aspect-video bg-monterey bg-cover rounded-lg border hover:border-blue-500 transition"></div>
                             </div>
                        </div>
                    </div>
                `
            },
            about: {
                title: '關於這台 Mac',
                width: 300,
                height: 400,
                content: `
                    <div class="flex flex-col items-center justify-center h-full bg-[#282828] p-6 text-center">
                        <i class="fa-brands fa-apple text-6xl text-gray-300 mb-4"></i>
                        <h2 class="text-xl font-bold mb-1">MacBook Pro</h2>
                        <p class="text-xs text-gray-400 mb-4">14-inch, 2025</p>
                        
                        <div class="bg-[#1e1e1e] rounded-lg p-4 w-full text-xs mb-4">
                            <div class="flex justify-between mb-2">
                                <span class="text-gray-400">晶片</span>
                                <span>Apple M4 Max</span>
                            </div>
                            <div class="flex justify-between mb-2">
                                <span class="text-gray-400">記憶體</span>
                                <span>64 GB</span>
                            </div>
                            <div class="flex justify-between mb-2">
                                <span class="text-gray-400">macOS</span>
                                <span>Sonoma 14.4</span>
                            </div>
                             <div class="flex justify-between">
                                <span class="text-gray-400">啟動磁碟</span>
                                <span>Macintosh HD</span>
                            </div>
                        </div>
                        <button class="bg-gray-600/50 border border-white/10 px-3 py-1 rounded hover:bg-gray-600 text-xs">更多資訊...</button>
                    </div>
                `
            }
        };

        function openWindow(appKey) {
            const existingWindow = document.getElementById(`window-${appKey}`);
            
            // If window minimized (logic roughly implemented by checking display)
            if (existingWindow) {
                if(existingWindow.style.display === 'none') {
                    existingWindow.style.display = 'flex';
                    existingWindow.style.transform = 'scale(0.9)';
                    setTimeout(() => existingWindow.style.transform = 'scale(1)', 10);
                }
                focusWindow(existingWindow);
                return;
            }

            const app = apps[appKey];
            const win = document.createElement('div');
            win.id = `window-${appKey}`;
            win.className = 'absolute flex flex-col rounded-xl overflow-hidden shadow-2xl glass window-transition pointer-events-auto';
            win.style.width = `${app.width}px`;
            win.style.height = `${app.height}px`;
            // Center randomly slightly
            win.style.left = `${Math.max(50, (window.innerWidth - app.width) / 2 + (Math.random() * 40 - 20))}px`;
            win.style.top = `${Math.max(50, (window.innerHeight - app.height) / 2 + (Math.random() * 40 - 20))}px`;
            win.style.zIndex = ++zIndexCounter;

            win.innerHTML = `
                <div class="window-header h-8 bg-white/5 border-b border-white/10 flex items-center justify-between px-3 select-none" onmousedown="startDrag(event, '${win.id}')">
                    <div class="flex gap-2 items-center group">
                        <div class="traffic-light traffic-close cursor-pointer" onclick="closeWindow('${appKey}')"></div>
                        <div class="traffic-light traffic-min cursor-pointer" onclick="minimizeWindow('${appKey}')"></div>
                        <div class="traffic-light traffic-max cursor-pointer" onclick="maximizeWindow('${appKey}')"></div>
                    </div>
                    <div class="text-xs text-gray-400 font-medium pointer-events-none">${app.title}</div>
                    <div class="w-10"></div> <!-- spacer -->
                </div>
                <div class="flex-1 relative overflow-hidden bg-[#1e1e1e]/90 backdrop-blur-xl" onclick="focusWindow(document.getElementById('${win.id}'))">
                    ${app.content}
                </div>
            `;

            windowsArea.appendChild(win);
            focusWindow(win);

            // Initialize terminal event if opened
            if(appKey === 'terminal') {
                initTerminal();
            }
        }

        function closeWindow(appKey) {
            const win = document.getElementById(`window-${appKey}`);
            if (win) {
                win.style.opacity = '0';
                win.style.transform = 'scale(0.9)';
                setTimeout(() => win.remove(), 200);
            }
        }
        
        function minimizeWindow(appKey) {
             const win = document.getElementById(`window-${appKey}`);
             if(win) {
                 win.style.transform = 'scale(0.5) translate(0, 500px)';
                 win.style.opacity = '0';
                 setTimeout(() => win.style.display = 'none', 300);
             }
        }

        function maximizeWindow(appKey) {
            const win = document.getElementById(`window-${appKey}`);
            if (win) {
                if (win.dataset.maximized === 'true') {
                    win.style.top = win.dataset.oldTop;
                    win.style.left = win.dataset.oldLeft;
                    win.style.width = win.dataset.oldWidth;
                    win.style.height = win.dataset.oldHeight;
                    win.dataset.maximized = 'false';
                    win.style.borderRadius = '0.75rem'; // xl
                } else {
                    win.dataset.oldTop = win.style.top;
                    win.dataset.oldLeft = win.style.left;
                    win.dataset.oldWidth = win.style.width;
                    win.dataset.oldHeight = win.style.height;
                    
                    win.style.top = '32px'; // Below menu bar
                    win.style.left = '0';
                    win.style.width = '100%';
                    win.style.height = 'calc(100% - 70px)'; // Above dock
                    win.dataset.maximized = 'true';
                    win.style.borderRadius = '0';
                }
            }
        }

        function focusWindow(win) {
            if (win) {
                win.style.zIndex = ++zIndexCounter;
                activeWindowId = win.id;
                // Update Menubar App Name roughly
                const appName = win.id.replace('window-', '');
                activeAppName.innerText = apps[appName].title.split(' ')[0];
            }
        }

        // --- Drag Logic ---
        let isDragging = false;
        let dragOffset = { x: 0, y: 0 };
        let dragWin = null;

        function startDrag(e, winId) {
            // Don't drag if clicking buttons
            if (e.target.classList.contains('traffic-light')) return;
            
            const win = document.getElementById(winId);
            focusWindow(win);
            if (win.dataset.maximized === 'true') return;

            isDragging = true;
            dragWin = win;
            const rect = win.getBoundingClientRect();
            dragOffset.x = e.clientX - rect.left;
            dragOffset.y = e.clientY - rect.top;
            
            // Disable transition during drag for performance
            win.classList.remove('window-transition');
        }

        window.addEventListener('mousemove', (e) => {
            if (isDragging && dragWin) {
                e.preventDefault();
                dragWin.style.left = `${e.clientX - dragOffset.x}px`;
                dragWin.style.top = `${e.clientY - dragOffset.y}px`;
            }
        });

        window.addEventListener('mouseup', () => {
            if (isDragging && dragWin) {
                dragWin.classList.add('window-transition');
            }
            isDragging = false;
            dragWin = null;
        });

        // --- App Logics ---

        // Terminal
        function initTerminal() {
            const input = document.getElementById('term-input');
            const output = document.getElementById('term-output');
            if (!input) return;

            input.focus();
            input.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    const val = this.value.trim();
                    const line = document.createElement('div');
                    line.innerHTML = `<span class="text-green-400 mr-2">user@MacBook-Pro ~ %</span> ${val}`;
                    output.appendChild(line);
                    
                    // Simple command handling
                    const response = document.createElement('div');
                    response.className = "text-gray-300 mb-1 whitespace-pre-wrap";
                    
                    switch(val.split(' ')[0]) {
                        case 'help':
                            response.innerText = "Available commands: help, clear, ls, date, echo, whoami";
                            break;
                        case 'clear':
                            output.innerHTML = '';
                            response.innerText = '';
                            break;
                        case 'ls':
                            response.innerText = "Desktop  Documents  Downloads  Movies  Music  Pictures  Public";
                            break;
                        case 'whoami':
                            response.innerText = "user";
                            break;
                        case 'date':
                            response.innerText = new Date().toString();
                            break;
                        case 'echo':
                            response.innerText = val.substring(5);
                            break;
                        case '':
                            response.innerText = '';
                            break;
                        default:
                            response.innerText = `zsh: command not found: ${val}`;
                    }
                    output.appendChild(response);
                    
                    this.value = '';
                    // scroll to bottom
                    const termWin = document.querySelector('.terminal-window');
                    if(termWin) termWin.scrollTop = termWin.scrollHeight;
                }
            });
        }

        // Calculator
        let calcDisplay = '0';
        let calcOperator = null;
        let calcPrevValue = null;
        let calcNewInput = false;

        function calc(val) {
            const displayEl = document.getElementById('calc-display');
            if (!displayEl) return;

            if (!isNaN(val) || val === '.') {
                if (calcDisplay === '0' || calcNewInput) {
                    calcDisplay = val;
                    calcNewInput = false;
                } else {
                    calcDisplay += val;
                }
            } else if (val === 'c') {
                calcDisplay = '0';
                calcOperator = null;
                calcPrevValue = null;
            } else if (val === 'n') {
                 calcDisplay = (parseFloat(calcDisplay) * -1).toString();
            } else if (val === '%') {
                 calcDisplay = (parseFloat(calcDisplay) / 100).toString();
            } else if (val === '=') {
                if (calcOperator && calcPrevValue !== null) {
                    const curr = parseFloat(calcDisplay);
                    const prev = parseFloat(calcPrevValue);
                    let res = 0;
                    if (calcOperator === '+') res = prev + curr;
                    if (calcOperator === '-') res = prev - curr;
                    if (calcOperator === '*') res = prev * curr;
                    if (calcOperator === '/') res = prev / curr;
                    calcDisplay = res.toString();
                    calcOperator = null;
                    calcNewInput = true;
                }
            } else {
                // Operator
                calcOperator = val;
                calcPrevValue = calcDisplay;
                calcNewInput = true;
            }
            
            // limit length
            if(calcDisplay.length > 9) calcDisplay = calcDisplay.substring(0,9);
            displayEl.innerText = calcDisplay;
        }

        // --- Control Center & Spotlight ---
        function toggleControlCenter() {
            const cc = document.getElementById('control-center');
            if (cc.classList.contains('hidden')) {
                cc.classList.remove('hidden');
                setTimeout(() => {
                    cc.classList.remove('scale-95', 'opacity-0');
                }, 10);
            } else {
                cc.classList.add('scale-95', 'opacity-0');
                setTimeout(() => {
                    cc.classList.add('hidden');
                }, 200);
            }
        }
        
        function openSpotlight() {
            const sp = document.getElementById('spotlight');
            sp.classList.remove('hidden');
            sp.querySelector('input').focus();
        }

        // Close dropdowns when clicking outside
        desktop.addEventListener('click', (e) => {
            const cc = document.getElementById('control-center');
            const sp = document.getElementById('spotlight');
            if (!e.target.closest('#control-center') && !e.target.closest('.fa-sliders') && !cc.classList.contains('hidden')) {
                toggleControlCenter();
            }
            if (!e.target.closest('#spotlight') && !e.target.closest('.fa-magnifying-glass') && !sp.classList.contains('hidden')) {
                sp.classList.add('hidden');
            }
        });

        // Change Wallpaper
        function setWallpaper(idx) {
            const desk = document.getElementById('desktop');
            const login = document.getElementById('login-screen');
            
            desk.classList.remove(...backgroundClasses);
            login.classList.remove(...backgroundClasses);
            
            desk.classList.add(backgroundClasses[idx]);
            login.classList.add(backgroundClasses[idx]);
        }

        function changeWallpaper() {
            currentBgIndex = (currentBgIndex + 1) % backgroundClasses.length;
            setWallpaper(currentBgIndex);
        }

        // Right click Context Menu (Simplified)
        window.addEventListener('contextmenu', (e) => {
            e.preventDefault();
            // In a full implementation, create a custom div at e.clientX, e.clientY
        });

    </script>
</body>
</html>