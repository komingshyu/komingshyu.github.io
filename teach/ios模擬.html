<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>iOS Simulator (Vanilla)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap');
        
        body {
            font-family: 'Noto Sans TC', sans-serif;
            user-select: none;
            -webkit-user-select: none;
        }

        /* Custom Scrollbar Hide */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* App Opening Animation */
        .app-open {
            animation: appOpen 0.3s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
        }
        .app-close {
            animation: appClose 0.3s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
        }

        @keyframes appOpen {
            from { transform: scale(0.8); opacity: 0; border-radius: 50px; }
            to { transform: scale(1); opacity: 1; border-radius: 40px; }
        }
        @keyframes appClose {
            from { transform: scale(1); opacity: 1; border-radius: 40px; }
            to { transform: scale(0.8); opacity: 0; border-radius: 50px; }
        }

        /* Control Center Animation */
        .cc-enter { transform: translateY(0); opacity: 1; visibility: visible; }
        .cc-exit { transform: translateY(-100%); opacity: 0; visibility: hidden; }

        /* Lock Screen Animation */
        .unlock-slide { transform: translateY(-100%); }
        
        /* Slider Thumb Customization */
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            opacity: 0;
        }
    </style>
</head>
<body class="bg-gray-900 h-screen w-full flex items-center justify-center overflow-hidden">

    <!-- Phone Frame -->
    <div id="phone" class="relative w-[360px] h-[760px] bg-black rounded-[55px] border-[12px] border-gray-800 shadow-2xl overflow-hidden ring-2 ring-gray-700">
        
        <!-- Wallpaper -->
        <div id="wallpaper" class="absolute inset-0 bg-cover bg-center transition-transform duration-500" 
             style="background-image: url('https://images.unsplash.com/photo-1618005182384-a83a8bd57fbe?q=80&w=2564&auto=format&fit=crop');">
        </div>

        <!-- Status Bar -->
        <div class="absolute top-0 w-full h-12 px-6 pt-3 flex justify-between items-start z-50 text-white font-medium text-sm mix-blend-difference pointer-events-none">
            <span id="status-time" class="pl-2">12:00</span>
            <div class="flex gap-1.5 items-center pr-2">
                <div id="status-icons" class="flex gap-1">
                    <i data-lucide="signal" class="w-3.5 h-3.5"></i>
                    <i data-lucide="wifi" class="w-3.5 h-3.5" id="status-wifi"></i>
                </div>
                <i data-lucide="battery" class="w-4 h-4 fill-current"></i>
            </div>
        </div>

        <!-- Dynamic Island -->
        <div class="absolute top-3 left-1/2 -translate-x-1/2 w-[100px] h-[28px] bg-black rounded-full z-[60] flex items-center justify-center transition-all duration-300 hover:w-[140px] hover:h-[34px] group cursor-pointer">
            <div class="w-2 h-2 rounded-full bg-green-500/20 absolute right-3 top-1/2 -translate-y-1/2 group-hover:bg-green-500 transition-colors"></div>
        </div>

        <!-- Control Center Trigger Area -->
        <div class="absolute top-0 right-0 w-20 h-8 z-[70] cursor-pointer" onclick="toggleControlCenter()"></div>

        <!-- Lock Screen -->
        <div id="lock-screen" class="absolute inset-0 z-30 flex flex-col items-center pt-20 text-white transition-transform duration-500 ease-in-out bg-black/0 backdrop-blur-none" onclick="unlockPhone()">
            <div class="flex flex-col items-center mt-8 drop-shadow-md">
                <i data-lucide="lock" class="w-5 h-5 mb-4 opacity-80"></i>
                <div id="lock-time" class="text-7xl font-light tracking-wide mb-2">12:00</div>
                <div id="lock-date" class="text-lg font-medium opacity-90">1月1日 星期一</div>
            </div>
            
            <!-- Bottom Lock Screen Buttons -->
            <div class="mt-auto w-full flex justify-between px-10 mb-12 z-40">
                <div id="btn-flashlight" class="w-12 h-12 rounded-full bg-gray-500/40 backdrop-blur-md flex items-center justify-center transition-colors cursor-pointer active:scale-90 duration-200" onclick="event.stopPropagation(); toggleFlashlight()">
                    <i data-lucide="flashlight" class="w-5 h-5 text-white"></i>
                </div>
                <div class="w-12 h-12 rounded-full bg-gray-500/40 backdrop-blur-md flex items-center justify-center text-white cursor-pointer active:scale-90 duration-200" onclick="event.stopPropagation()">
                    <i data-lucide="camera" class="w-5 h-5"></i>
                </div>
            </div>
            <div class="mb-2 text-xs font-medium opacity-60 animate-pulse">向上滑動以解鎖</div>
            <div class="w-32 h-1 bg-white rounded-full mb-2"></div>
        </div>

        <!-- Home Screen -->
        <div id="home-screen" class="absolute inset-0 z-10 pt-16 pb-8 px-5 flex flex-col transition-all duration-500 scale-90 opacity-0 pointer-events-none">
            <!-- Grid -->
            <div class="grid grid-cols-4 gap-y-5 gap-x-4" id="app-grid">
                <!-- Apps will be injected by JS -->
            </div>

            <!-- Pagination Dots -->
            <div class="mt-auto mb-4 flex justify-center gap-2">
                <div class="w-1.5 h-1.5 rounded-full bg-white"></div>
                <div class="w-1.5 h-1.5 rounded-full bg-white/40"></div>
            </div>

            <!-- Dock -->
            <div class="w-full h-24 bg-white/20 backdrop-blur-xl rounded-[35px] flex items-center justify-evenly px-2" id="dock-grid">
                <!-- Dock Apps injected by JS -->
            </div>
        </div>

        <!-- Active App Container -->
        <div id="app-container" class="absolute inset-0 z-40 bg-white hidden overflow-hidden">
            <div id="app-content" class="w-full h-full"></div>
            <!-- Home Bar -->
            <div class="absolute bottom-0 left-0 w-full h-6 z-50 flex justify-center items-end pb-2 cursor-pointer" onclick="closeApp()">
                <div class="w-32 h-1.5 bg-black/20 backdrop-blur rounded-full hover:bg-black/40 transition-colors"></div>
            </div>
        </div>

        <!-- Control Center -->
        <div id="control-center" class="absolute inset-0 z-50 bg-black/20 backdrop-blur-2xl transition-all duration-300 cc-exit">
            <div class="pt-14 px-6 grid grid-cols-4 gap-4">
                <!-- Connectivity -->
                <div class="col-span-2 row-span-2 bg-gray-800/80 rounded-2xl p-3 grid grid-cols-2 gap-2">
                    <div id="cc-airplane" class="w-full aspect-square rounded-full bg-gray-600/50 text-gray-300 flex items-center justify-center cursor-pointer transition-colors" onclick="toggleSystem('airplane')">
                        <i data-lucide="plane" class="w-5 h-5"></i>
                    </div>
                    <div id="cc-wifi" class="w-full aspect-square rounded-full bg-blue-500 text-white flex items-center justify-center cursor-pointer transition-colors" onclick="toggleSystem('wifi')">
                        <i data-lucide="wifi" class="w-5 h-5"></i>
                    </div>
                    <div id="cc-bluetooth" class="w-full aspect-square rounded-full bg-blue-500 text-white flex items-center justify-center cursor-pointer transition-colors" onclick="toggleSystem('bluetooth')">
                        <i data-lucide="bluetooth" class="w-5 h-5"></i>
                    </div>
                    <div class="w-full aspect-square rounded-full bg-green-500 text-white flex items-center justify-center">
                        <i data-lucide="signal" class="w-5 h-5"></i>
                    </div>
                </div>

                <!-- Music -->
                <div class="col-span-2 row-span-2 bg-gray-800/80 rounded-2xl p-3 flex flex-col justify-between">
                    <div class="flex items-center gap-2">
                        <div class="w-8 h-8 bg-gray-600 rounded-md flex items-center justify-center text-gray-400">
                            <i data-lucide="music" class="w-4 h-4"></i>
                        </div>
                        <span class="text-white text-xs">未在播放</span>
                    </div>
                    <div class="flex justify-between text-white px-1 text-sm">
                        <i data-lucide="skip-back" class="w-5 h-5 fill-current"></i>
                        <i data-lucide="play" class="w-5 h-5 fill-current"></i>
                        <i data-lucide="skip-forward" class="w-5 h-5 fill-current"></i>
                    </div>
                </div>

                <!-- Sliders -->
                <div class="col-span-1 row-span-2 bg-white/20 rounded-2xl relative overflow-hidden group">
                    <div id="brightness-fill" class="absolute bottom-0 left-0 right-0 bg-white transition-all h-[80%]"></div>
                    <div class="absolute inset-0 flex items-end justify-center pb-4 pointer-events-none z-10">
                        <i data-lucide="sun" class="w-6 h-6 text-gray-800"></i>
                    </div>
                    <input type="range" class="absolute inset-0 opacity-0 z-20 cursor-ns-resize" min="0" max="100" value="80" oninput="updateSlider(this, 'brightness-fill')">
                </div>
                <div class="col-span-1 row-span-2 bg-white/20 rounded-2xl relative overflow-hidden group">
                    <div id="volume-fill" class="absolute bottom-0 left-0 right-0 bg-white transition-all h-[60%]"></div>
                    <div class="absolute inset-0 flex items-end justify-center pb-4 pointer-events-none z-10">
                        <i data-lucide="volume-2" class="w-6 h-6 text-gray-800"></i>
                    </div>
                    <input type="range" class="absolute inset-0 opacity-0 z-20 cursor-ns-resize" min="0" max="100" value="60" oninput="updateSlider(this, 'volume-fill')">
                </div>

                <!-- Toggles -->
                <div class="col-span-2 flex gap-4">
                     <div class="flex-1 bg-gray-800/80 rounded-2xl py-2 flex flex-col items-center justify-center text-white text-[10px]">
                        <i data-lucide="lock" class="w-5 h-5 mb-1"></i>
                        <span>鎖定旋轉</span>
                     </div>
                     <div class="flex-1 bg-gray-800/80 rounded-2xl py-2 flex flex-col items-center justify-center text-white text-[10px]">
                        <i data-lucide="copy" class="w-5 h-5 mb-1"></i>
                        <span>鏡像輸出</span>
                     </div>
                </div>

                <!-- Bottom Icons -->
                <div id="cc-flashlight-btn" class="col-span-1 bg-gray-800/80 rounded-2xl aspect-square flex items-center justify-center text-white cursor-pointer" onclick="toggleFlashlight()">
                    <i data-lucide="flashlight" class="w-6 h-6" id="cc-flashlight-icon"></i>
                </div>
                <div class="col-span-1 bg-gray-800/80 rounded-2xl aspect-square flex items-center justify-center text-white cursor-pointer" onclick="openApp('calculator'); toggleControlCenter()">
                    <i data-lucide="calculator" class="w-6 h-6"></i>
                </div>
                <div class="col-span-1 bg-gray-800/80 rounded-2xl aspect-square flex items-center justify-center text-white cursor-pointer" onclick="openApp('camera'); toggleControlCenter()">
                    <i data-lucide="camera" class="w-6 h-6"></i>
                </div>
                 <div class="col-span-1 bg-gray-800/80 rounded-2xl aspect-square flex items-center justify-center text-white cursor-pointer" onclick="openApp('timer'); toggleControlCenter()">
                    <i data-lucide="timer" class="w-6 h-6"></i>
                </div>
            </div>

            <!-- Close Area -->
            <div class="absolute bottom-0 w-full h-20 flex justify-center items-end pb-4 cursor-pointer" onclick="toggleControlCenter()">
                 <div class="w-32 h-1 bg-white rounded-full"></div>
            </div>
        </div>

        <!-- System Home Bar -->
        <div id="home-bar-indicator" class="absolute bottom-2 left-1/2 -translate-x-1/2 w-32 h-1.5 bg-white rounded-full z-20 hidden"></div>

    </div>

    <div class="fixed bottom-4 right-4 text-gray-500 text-xs text-right">
        <p>iOS 模擬器 (原生 JS 版)</p>
        <p>點擊畫面解鎖 • 右上角下滑控制中心</p>
    </div>

    <script>
        // --- State ---
        const state = {
            locked: true,
            controlCenter: false,
            activeApp: null,
            wifi: true,
            bluetooth: true,
            airplane: false,
            flashlight: false
        };

        // --- DOM Elements ---
        const els = {
            lockScreen: document.getElementById('lock-screen'),
            homeScreen: document.getElementById('home-screen'),
            appContainer: document.getElementById('app-container'),
            appContent: document.getElementById('app-content'),
            controlCenter: document.getElementById('control-center'),
            homeBar: document.getElementById('home-bar-indicator'),
            wallpaper: document.getElementById('wallpaper'),
            statusWifi: document.getElementById('status-wifi'),
            statusIcons: document.getElementById('status-icons'),
            btnFlashlight: document.getElementById('btn-flashlight'),
            ccFlashlightBtn: document.getElementById('cc-flashlight-btn'),
            ccFlashlightIcon: document.getElementById('cc-flashlight-icon'),
            ccWifi: document.getElementById('cc-wifi'),
            ccBt: document.getElementById('cc-bluetooth'),
            ccAirplane: document.getElementById('cc-airplane')
        };

        // --- App Configuration ---
        const apps = [
            { id: 'weather', name: '天氣', color: 'bg-blue-400', icon: 'cloud-rain', iconColor: 'text-white' },
            { id: 'calendar', name: '行事曆', color: 'bg-white', customIcon: true },
            { id: 'photos', name: '照片', color: 'bg-white', customIconHtml: '<div class="relative w-full h-full flex items-center justify-center"><div class="w-4 h-4 rounded-full bg-red-400 absolute top-2 left-2 opacity-70 mix-blend-multiply"></div><div class="w-4 h-4 rounded-full bg-green-400 absolute top-2 right-2 opacity-70 mix-blend-multiply"></div><div class="w-4 h-4 rounded-full bg-blue-400 absolute bottom-2 left-1/2 -translate-x-1/2 opacity-70 mix-blend-multiply"></div></div>' },
            { id: 'camera', name: '相機', color: 'bg-gray-300', icon: 'camera', iconColor: 'text-black' },
            { id: 'mail', name: '郵件', color: 'bg-blue-500', icon: 'mail', iconColor: 'text-white' },
            { id: 'clock', name: '時鐘', color: 'bg-black', icon: 'clock', iconColor: 'text-white' },
            { id: 'calculator', name: '計算機', color: 'bg-gray-900', icon: 'calculator', iconColor: 'text-white' },
            { id: 'settings', name: '設定', color: 'bg-gray-500', icon: 'settings', iconColor: 'text-white' },
        ];

        const dockApps = [
            { id: 'phone', name: '電話', color: 'bg-green-500', icon: 'phone', iconColor: 'text-white', fill: true },
            { id: 'safari', name: 'Safari', color: 'bg-white', icon: 'compass', iconColor: 'text-blue-500' },
            { id: 'messages', name: '訊息', color: 'bg-green-500', icon: 'message-square', iconColor: 'text-white', fill: true },
            { id: 'music', name: '音樂', color: 'bg-white', icon: 'music', iconColor: 'text-red-500' },
        ];

        // --- Initialization ---
        function init() {
            updateTime();
            setInterval(updateTime, 1000);
            renderApps();
            renderDock();
            lucide.createIcons();
            updateSystemUI();
        }

        // --- Render Logic ---
        function renderApps() {
            const grid = document.getElementById('app-grid');
            apps.forEach(app => {
                grid.appendChild(createAppIcon(app));
            });
        }

        function renderDock() {
            const dock = document.getElementById('dock-grid');
            dockApps.forEach(app => {
                dock.appendChild(createAppIcon(app));
            });
        }

        function createAppIcon(app) {
            const container = document.createElement('div');
            container.className = 'flex flex-col items-center gap-1 cursor-pointer active:opacity-70 transition-opacity';
            container.onclick = () => openApp(app.id);

            const iconBox = document.createElement('div');
            iconBox.className = `w-[60px] h-[60px] ${app.color} rounded-[14px] flex items-center justify-center shadow-sm overflow-hidden`;
            
            if (app.customIcon) {
                // Dynamic Calendar Icon
                const date = new Date();
                iconBox.innerHTML = `
                    <div class="flex flex-col items-center justify-center w-full h-full bg-white text-black pt-1">
                        <span class="text-[9px] text-red-500 font-bold uppercase tracking-wide">${date.toLocaleDateString('zh-TW', {weekday:'short'})}</span>
                        <span class="text-3xl font-light -mt-1">${date.getDate()}</span>
                    </div>
                `;
            } else if (app.customIconHtml) {
                iconBox.innerHTML = app.customIconHtml;
            } else {
                const i = document.createElement('i');
                i.setAttribute('data-lucide', app.icon);
                i.className = `w-8 h-8 ${app.iconColor}`;
                if (app.fill) i.setAttribute('fill', 'currentColor');
                iconBox.appendChild(i);
            }

            const name = document.createElement('span');
            name.className = 'text-[11px] text-white font-medium tracking-tight drop-shadow-md';
            name.innerText = app.name;

            container.appendChild(iconBox);
            container.appendChild(name);
            return container;
        }

        // --- Time & Date ---
        function updateTime() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('zh-TW', { hour: '2-digit', minute: '2-digit', hour12: false });
            const dateStr = `${now.getMonth() + 1}月${now.getDate()}日 ${now.toLocaleDateString('zh-TW', {weekday:'long'})}`;

            document.getElementById('status-time').innerText = timeStr;
            document.getElementById('lock-time').innerText = timeStr;
            document.getElementById('lock-date').innerText = dateStr;
        }

        // --- Interactions ---
        function unlockPhone() {
            if (!state.locked) return;
            state.locked = false;
            
            els.lockScreen.classList.add('unlock-slide');
            // Fade out lock screen content
            els.lockScreen.style.opacity = '0';
            els.lockScreen.style.pointerEvents = 'none';

            // Show home screen
            els.homeScreen.classList.remove('scale-90', 'opacity-0', 'pointer-events-none');
            els.homeScreen.classList.add('scale-100', 'opacity-100');
            
            els.homeBar.classList.remove('hidden');
            
            // Blur wallpaper
            els.wallpaper.style.filter = 'blur(0px)';
        }

        function toggleControlCenter() {
            state.controlCenter = !state.controlCenter;
            if (state.controlCenter) {
                els.controlCenter.classList.remove('cc-exit');
                els.controlCenter.classList.add('cc-enter');
                els.wallpaper.style.filter = 'blur(10px)';
            } else {
                els.controlCenter.classList.remove('cc-enter');
                els.controlCenter.classList.add('cc-exit');
                if (!state.activeApp) els.wallpaper.style.filter = 'blur(0px)';
            }
        }

        function toggleSystem(type) {
            state[type] = !state[type];
            updateSystemUI();
        }

        function toggleFlashlight() {
            state.flashlight = !state.flashlight;
            updateSystemUI();
        }

        function updateSystemUI() {
            // Wifi
            els.statusWifi.style.display = state.wifi && !state.airplane ? 'block' : 'none';
            els.ccWifi.className = `w-full aspect-square rounded-full flex items-center justify-center cursor-pointer transition-colors ${state.wifi ? 'bg-blue-500 text-white' : 'bg-gray-600/50 text-gray-300'}`;
            
            // Bluetooth
            els.ccBt.className = `w-full aspect-square rounded-full flex items-center justify-center cursor-pointer transition-colors ${state.bluetooth ? 'bg-blue-500 text-white' : 'bg-gray-600/50 text-gray-300'}`;
            
            // Airplane
            els.ccAirplane.className = `w-full aspect-square rounded-full flex items-center justify-center cursor-pointer transition-colors ${state.airplane ? 'bg-orange-500 text-white' : 'bg-gray-600/50 text-gray-300'}`;
            if (state.airplane) {
                els.statusIcons.innerHTML = '<i data-lucide="plane" class="w-3.5 h-3.5"></i>';
            } else {
                els.statusIcons.innerHTML = `<i data-lucide="signal" class="w-3.5 h-3.5"></i><i data-lucide="wifi" class="w-3.5 h-3.5" style="display:${state.wifi ? 'block' : 'none'}"></i>`;
            }
            lucide.createIcons();

            // Flashlight
            const flashClass = state.flashlight ? 'bg-white text-black' : 'text-white';
            const ccFlashClass = state.flashlight ? 'bg-white text-blue-500' : 'text-white';
            els.btnFlashlight.className = `w-12 h-12 rounded-full bg-gray-500/40 backdrop-blur-md flex items-center justify-center transition-colors cursor-pointer active:scale-90 duration-200 ${flashClass}`;
            els.ccFlashlightIcon.setAttribute('fill', state.flashlight ? 'currentColor' : 'none');
            els.ccFlashlightBtn.className = `col-span-1 bg-gray-800/80 rounded-2xl aspect-square flex items-center justify-center cursor-pointer ${state.flashlight ? 'text-blue-400' : 'text-white'}`;
            if (state.flashlight) els.ccFlashlightIcon.setAttribute('fill', 'currentColor');
             else els.ccFlashlightIcon.setAttribute('fill', 'none');
        }

        function updateSlider(input, fillId) {
            document.getElementById(fillId).style.height = input.value + '%';
        }

        // --- App Logic ---
        function openApp(appId) {
            if (state.controlCenter) toggleControlCenter(); // Close CC if open
            state.activeApp = appId;
            els.appContainer.classList.remove('hidden');
            els.appContainer.classList.remove('app-close');
            els.appContainer.classList.add('app-open');
            els.homeBar.classList.add('hidden');
            
            els.wallpaper.style.transform = 'scale(0.95)';

            renderAppContent(appId);
        }

        function closeApp() {
            state.activeApp = null;
            els.appContainer.classList.remove('app-open');
            els.appContainer.classList.add('app-close');
            
            setTimeout(() => {
                els.appContainer.classList.add('hidden');
                els.appContent.innerHTML = '';
            }, 300);

            els.homeBar.classList.remove('hidden');
            els.wallpaper.style.transform = 'scale(1)';
        }

        function renderAppContent(id) {
            els.appContent.innerHTML = '';
            let content = '';

            if (id === 'calculator') {
                content = `
                <div class="h-full bg-black text-white flex flex-col justify-end p-4 pb-8">
                    <div id="calc-display" class="text-right text-6xl font-light mb-4 px-2 break-all leading-none">0</div>
                    <div class="grid grid-cols-4 gap-3">
                        <button class="calc-btn bg-gray-400 text-black" onclick="calc.clear()">AC</button>
                        <button class="calc-btn bg-gray-400 text-black" onclick="calc.op('+/-')">+/-</button>
                        <button class="calc-btn bg-gray-400 text-black" onclick="calc.op('%')">%</button>
                        <button class="calc-btn bg-orange-500 text-white" onclick="calc.op('÷')">÷</button>
                        <button class="calc-btn bg-gray-800 text-white" onclick="calc.num('7')">7</button>
                        <button class="calc-btn bg-gray-800 text-white" onclick="calc.num('8')">8</button>
                        <button class="calc-btn bg-gray-800 text-white" onclick="calc.num('9')">9</button>
                        <button class="calc-btn bg-orange-500 text-white" onclick="calc.op('×')">×</button>
                        <button class="calc-btn bg-gray-800 text-white" onclick="calc.num('4')">4</button>
                        <button class="calc-btn bg-gray-800 text-white" onclick="calc.num('5')">5</button>
                        <button class="calc-btn bg-gray-800 text-white" onclick="calc.num('6')">6</button>
                        <button class="calc-btn bg-orange-500 text-white" onclick="calc.op('-')">-</button>
                        <button class="calc-btn bg-gray-800 text-white" onclick="calc.num('1')">1</button>
                        <button class="calc-btn bg-gray-800 text-white" onclick="calc.num('2')">2</button>
                        <button class="calc-btn bg-gray-800 text-white" onclick="calc.num('3')">3</button>
                        <button class="calc-btn bg-orange-500 text-white" onclick="calc.op('+')">+</button>
                        <button class="col-span-2 bg-gray-800 text-white h-16 rounded-full flex items-center pl-7 text-2xl font-medium active:opacity-70" onclick="calc.num('0')">0</button>
                        <button class="calc-btn bg-gray-800 text-white" onclick="calc.num('.')">.</button>
                        <button class="calc-btn bg-orange-500 text-white" onclick="calc.calc()">=</button>
                    </div>
                </div>
                <style>.calc-btn { height: 4rem; width: 4rem; border-radius: 9999px; font-size: 1.5rem; font-weight: 500; transition: opacity 0.2s; } .calc-btn:active { opacity: 0.7; }</style>
                `;
            } else if (id === 'settings') {
                content = `
                <div class="h-full bg-gray-100 text-black overflow-y-auto pb-10 no-scrollbar">
                    <div class="pt-12 pb-4 px-4">
                        <h1 class="text-3xl font-bold">設定</h1>
                        <div class="mt-2 relative">
                            <input type="text" placeholder="搜尋" class="w-full pl-9 pr-4 py-1.5 bg-gray-200 rounded-lg text-sm focus:outline-none" />
                            <i data-lucide="search" class="absolute top-2 left-2 w-4 h-4 text-gray-500"></i>
                        </div>
                    </div>
                    <div class="space-y-6 px-4">
                        <div class="rounded-xl overflow-hidden bg-white divide-y divide-gray-100">
                            <div class="flex items-center justify-between p-3 active:bg-gray-100 cursor-pointer" onclick="toggleSystem('airplane')">
                                <div class="flex items-center gap-3"><div class="w-7 h-7 rounded-md bg-orange-500 flex items-center justify-center text-white"><i data-lucide="plane" class="w-4 h-4"></i></div><span>飛航模式</span></div>
                                <div class="w-12 h-7 rounded-full p-1 duration-300 ${state.airplane ? 'bg-green-500' : 'bg-gray-200'}"><div class="bg-white w-5 h-5 rounded-full shadow-sm duration-300 transform ${state.airplane ? 'translate-x-5' : ''}"></div></div>
                            </div>
                            <div class="flex items-center justify-between p-3 active:bg-gray-100 cursor-pointer" onclick="toggleSystem('wifi')">
                                <div class="flex items-center gap-3"><div class="w-7 h-7 rounded-md bg-blue-500 flex items-center justify-center text-white"><i data-lucide="wifi" class="w-4 h-4"></i></div><span>Wi-Fi</span></div>
                                <div class="flex items-center gap-2"><span class="text-gray-400 text-sm">${state.wifi ? 'TPE-Free' : '關閉'}</span><i data-lucide="chevron-right" class="w-4 h-4 text-gray-300"></i></div>
                            </div>
                            <div class="flex items-center justify-between p-3 active:bg-gray-100 cursor-pointer" onclick="toggleSystem('bluetooth')">
                                <div class="flex items-center gap-3"><div class="w-7 h-7 rounded-md bg-blue-500 flex items-center justify-center text-white"><i data-lucide="bluetooth" class="w-4 h-4"></i></div><span>藍牙</span></div>
                                <div class="flex items-center gap-2"><span class="text-gray-400 text-sm">${state.bluetooth ? '開啟' : '關閉'}</span><i data-lucide="chevron-right" class="w-4 h-4 text-gray-300"></i></div>
                            </div>
                        </div>
                        <div class="rounded-xl overflow-hidden bg-white divide-y divide-gray-100">
                             <div class="flex items-center justify-between p-3"><div class="flex items-center gap-3"><div class="w-7 h-7 rounded-md bg-gray-500 flex items-center justify-center text-white"><i data-lucide="settings" class="w-4 h-4"></i></div><span>一般</span></div><i data-lucide="chevron-right" class="w-4 h-4 text-gray-300"></i></div>
                             <div class="flex items-center justify-between p-3"><div class="flex items-center gap-3"><div class="w-7 h-7 rounded-md bg-blue-500 flex items-center justify-center text-white"><i data-lucide="sun" class="w-4 h-4"></i></div><span>螢幕顯示與亮度</span></div><i data-lucide="chevron-right" class="w-4 h-4 text-gray-300"></i></div>
                        </div>
                    </div>
                </div>`;
            } else if (id === 'weather') {
                content = `
                <div class="h-full bg-gradient-to-b from-blue-400 to-blue-600 text-white flex flex-col p-6 pt-14">
                    <div class="flex flex-col items-center mb-8">
                        <h2 class="text-2xl font-medium">台北市</h2>
                        <span class="text-8xl font-thin flex items-start ml-4">24<span class="text-6xl mt-2">°</span></span>
                        <span class="text-xl font-medium text-blue-100">多雲時晴</span>
                        <div class="flex gap-4 mt-1 text-blue-100 font-medium"><span>最高 28°</span><span>最低 21°</span></div>
                    </div>
                    <div class="bg-blue-500/30 backdrop-blur-md rounded-xl p-4 flex-1">
                        <div class="flex justify-between items-center mb-2 text-blue-100/80 text-xs font-semibold uppercase"><span>預報</span></div>
                        <div class="space-y-4">
                             <div class="flex items-center justify-between"><span class="w-12 font-medium">今天</span><i data-lucide="cloud" class="w-5 h-5"></i><div class="flex items-center gap-2 text-sm text-blue-100"><span>21°</span><div class="w-20 h-1 bg-black/10 rounded-full"><div class="h-full bg-yellow-300 w-2/3 mx-auto rounded-full"></div></div><span>28°</span></div></div>
                             <div class="flex items-center justify-between"><span class="w-12 font-medium">週六</span><i data-lucide="sun" class="w-5 h-5"></i><div class="flex items-center gap-2 text-sm text-blue-100"><span>22°</span><div class="w-20 h-1 bg-black/10 rounded-full"><div class="h-full bg-yellow-300 w-full mx-auto rounded-full"></div></div><span>29°</span></div></div>
                             <div class="flex items-center justify-between"><span class="w-12 font-medium">週日</span><i data-lucide="cloud-rain" class="w-5 h-5"></i><div class="flex items-center gap-2 text-sm text-blue-100"><span>20°</span><div class="w-20 h-1 bg-black/10 rounded-full"><div class="h-full bg-yellow-300 w-1/2 mx-auto rounded-full"></div></div><span>25°</span></div></div>
                        </div>
                    </div>
                </div>`;
            } else if (id === 'photos') {
                 const images = [
                    "https://images.unsplash.com/photo-1707343843437-caacff5cfa74", "https://images.unsplash.com/photo-1707345512638-997d31a10eaa", "https://images.unsplash.com/photo-1705615242085-61802b86b3d0",
                    "https://images.unsplash.com/photo-1682687220509-61b8a906ca19", "https://images.unsplash.com/photo-1682687221038-404670f01d03", "https://images.unsplash.com/photo-1682687981922-7b55dbb30892",
                    "https://images.unsplash.com/photo-1517841905240-472988babdf9", "https://images.unsplash.com/photo-1539571696357-5a69c17a67c6", "https://images.unsplash.com/photo-1526047932273-341f2a7631f9"
                ];
                content = `
                <div class="h-full bg-white text-black flex flex-col">
                    <div class="pt-12 px-4 pb-2 flex justify-between items-end border-b border-gray-200 bg-white/90 backdrop-blur sticky top-0 z-10">
                        <h1 class="text-3xl font-bold">圖庫</h1>
                        <span class="text-blue-500 text-lg cursor-pointer">選取</span>
                    </div>
                    <div class="flex-1 overflow-y-auto grid grid-cols-3 gap-0.5 p-0.5 no-scrollbar">
                        ${images.map(url => `<div class="aspect-square bg-gray-100"><img src="${url}?w=200&h=200&fit=crop" class="w-full h-full object-cover"></div>`).join('')}
                    </div>
                    <div class="h-20 border-t border-gray-200 flex justify-around items-center pb-5 bg-white/90 backdrop-blur">
                        <div class="flex flex-col items-center text-blue-500"><i data-lucide="image" class="w-6 h-6 fill-current"></i><span class="text-[10px] font-medium mt-1">圖庫</span></div>
                        <div class="flex flex-col items-center text-gray-400"><i data-lucide="search" class="w-6 h-6"></i><span class="text-[10px] font-medium mt-1">搜尋</span></div>
                    </div>
                </div>`;
            } else if (id === 'messages') {
                content = `
                <div class="h-full bg-white text-black flex flex-col">
                    <div class="pt-12 px-4 pb-2 flex justify-between items-center border-b border-gray-200 bg-white/90 backdrop-blur sticky top-0 z-10">
                        <span class="text-blue-500 text-lg">編輯</span><h1 class="text-lg font-bold">訊息</h1><i data-lucide="square-pen" class="w-6 h-6 text-blue-500"></i>
                    </div>
                    <div class="flex-1 overflow-y-auto no-scrollbar">
                        <div class="px-4 py-4 border-b border-gray-100 flex items-center gap-3">
                             <div class="w-12 h-12 rounded-full bg-gradient-to-br from-gray-300 to-gray-400 flex items-center justify-center text-white font-bold">媽</div>
                             <div class="flex-1"><div class="flex justify-between"><h3 class="font-semibold">媽媽</h3><span class="text-sm text-gray-400">上午 10:30</span></div><p class="text-gray-500 text-sm truncate">您的包裹已送達管理室。</p></div>
                             <div class="w-3 h-3 bg-blue-500 rounded-full"></div>
                        </div>
                        <div class="px-4 py-4 border-b border-gray-100 flex items-center gap-3">
                             <div class="w-12 h-12 rounded-full bg-gradient-to-br from-gray-300 to-gray-400 flex items-center justify-center text-white font-bold">老</div>
                             <div class="flex-1"><div class="flex justify-between"><h3 class="font-semibold">老闆</h3><span class="text-sm text-gray-400">昨日</span></div><p class="text-gray-500 text-sm truncate">明天會議改到下午兩點。</p></div>
                        </div>
                         <div class="px-4 py-4 border-b border-gray-100 flex items-center gap-3">
                             <div class="w-12 h-12 rounded-full bg-gradient-to-br from-gray-300 to-gray-400 flex items-center justify-center text-white font-bold">A</div>
                             <div class="flex-1"><div class="flex justify-between"><h3 class="font-semibold">Apple</h3><span class="text-sm text-gray-400">週三</span></div><p class="text-gray-500 text-sm truncate">您的 Apple ID 驗證碼是 4920。</p></div>
                        </div>
                    </div>
                </div>`;
            } else {
                content = `<div class="h-full flex items-center justify-center bg-white text-xl font-bold">${apps.find(a=>a.id===id)?.name || dockApps.find(a=>a.id===id)?.name}</div>`;
            }

            els.appContent.innerHTML = content;
            lucide.createIcons();
        }

        // --- Calculator Logic ---
        const calc = {
            display: '0',
            prev: null,
            opVar: null,
            newNum: true,
            updateDisplay: () => document.getElementById('calc-display').innerText = calc.display,
            num: (n) => {
                if (calc.newNum) { calc.display = n; calc.newNum = false; }
                else { calc.display = calc.display === '0' ? n : calc.display + n; }
                calc.updateDisplay();
            },
            op: (o) => {
                 if (o === 'AC') { calc.display = '0'; calc.prev = null; calc.opVar = null; calc.newNum = true; }
                 else if (o === '+/-') { calc.display = String(parseFloat(calc.display) * -1); }
                 else if (o === '%') { calc.display = String(parseFloat(calc.display) / 100); }
                 else { calc.prev = calc.display; calc.opVar = o; calc.newNum = true; }
                 calc.updateDisplay();
            },
            clear: () => calc.op('AC'),
            calc: () => {
                if (!calc.prev || !calc.opVar) return;
                const curr = parseFloat(calc.display);
                const prev = parseFloat(calc.prev);
                let res = 0;
                if (calc.opVar === '+') res = prev + curr;
                if (calc.opVar === '-') res = prev - curr;
                if (calc.opVar === '×') res = prev * curr;
                if (calc.opVar === '÷') res = prev / curr;
                calc.display = String(res);
                calc.prev = null;
                calc.opVar = null;
                calc.newNum = true;
                calc.updateDisplay();
            }
        };

        // Start
        init();

    </script>
</body>
</html>