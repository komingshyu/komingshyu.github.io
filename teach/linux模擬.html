<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ubuntu Gemini Edition - Web Simulation</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Ubuntu:wght@300;400;500;700&family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* 全局字體設定 - Ubuntu Style */
        body {
            font-family: 'Ubuntu', 'Noto Sans TC', sans-serif;
            overflow: hidden;
            user-select: none;
        }
        
        .font-mono {
            font-family: 'JetBrains Mono', monospace;
        }

        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.1);
        }
        ::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.2);
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255,255,255,0.4);
        }

        .window-transition {
            transition: transform 0.15s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.15s ease, width 0.2s ease, height 0.2s ease;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }
        .animate-blink {
            animation: blink 1s infinite;
        }

        /* Ubuntu 桌布風格 */
        #desktop-bg {
            background: linear-gradient(135deg, #2c001e 0%, #77216f 50%, #E95420 100%);
            background-size: cover;
        }

        /* Yaru Dark 風格視窗 */
        .yaru-panel {
            background: #1e1e1e;
            border: 1px solid rgba(0, 0, 0, 0.4);
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }
        
        .yaru-header {
            background: #2c2c2c;
            border-bottom: 1px solid #111;
        }

        .cursor {
            display: inline-block;
            width: 8px;
            height: 16px;
            background-color: #ccc;
            animation: blink 1s step-end infinite;
            vertical-align: middle;
        }

        .crt::before {
            content: " ";
            display: block;
            position: absolute;
            top: 0; left: 0; bottom: 0; right: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            z-index: 2;
            background-size: 100% 2px, 3px 100%;
            pointer-events: none;
        }
    </style>
</head>
<body class="bg-black text-white h-screen w-screen overflow-hidden">

    <!-- 1. Boot Screen (Ubuntu Style) -->
    <div id="boot-screen" class="absolute inset-0 z-50 bg-black flex flex-col items-center justify-center text-white transition-opacity duration-500">
         <div class="flex flex-col items-center gap-4 mb-20">
            <!-- Simple Circle Logo Simulation -->
            <div class="w-24 h-24 rounded-full border-4 border-white/20 flex items-center justify-center relative">
                 <div class="absolute top-0 w-4 h-24 bg-black rotate-45"></div>
                 <div class="absolute top-0 w-4 h-24 bg-black -rotate-45"></div>
                 <div class="w-16 h-16 bg-white rounded-full"></div>
            </div>
            <h1 class="text-3xl font-bold tracking-wider mt-4">ubuntu</h1>
            <div class="mt-8 flex gap-2">
                <div class="w-2 h-2 bg-white rounded-full animate-bounce" style="animation-delay: 0s"></div>
                <div class="w-2 h-2 bg-white rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
                <div class="w-2 h-2 bg-white rounded-full animate-bounce" style="animation-delay: 0.4s"></div>
            </div>
         </div>
         <div id="boot-logs" class="absolute bottom-10 left-10 font-mono text-xs text-gray-500 hidden">
             <!-- Hidden logs for cleaner look -->
         </div>
    </div>

    <!-- 2. Login Screen (GDM Style) -->
    <div id="login-screen" class="absolute inset-0 z-40 bg-[#2c001e] flex flex-col items-center justify-center hidden transition-opacity duration-500 opacity-0">
        <div class="absolute inset-0 bg-gradient-to-br from-[#2c001e] to-[#77216f] opacity-90"></div>
        
        <div class="z-10 flex flex-col items-center w-80">
            <div class="w-24 h-24 rounded-full bg-gray-300 mb-6 flex items-center justify-center text-4xl overflow-hidden shadow-lg border-4 border-white/10">
                <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=ubuntu" alt="User" class="w-full h-full">
            </div>
            <h2 class="text-2xl font-bold mb-6 text-white">Ubuntu User</h2>
            <div class="w-full relative">
                <input type="password" id="password-input" placeholder="Password" 
                    class="w-full bg-[#3E3E3E] border border-gray-600 rounded px-4 py-2 text-white focus:outline-none focus:border-[#E95420] transition-colors placeholder-gray-500">
                <div id="login-msg" class="absolute -bottom-6 w-full text-center text-xs text-[#E95420] h-4 font-bold"></div>
            </div>
            <button onclick="system.login()" class="mt-6 px-8 py-2 bg-[#3E3E3E] hover:bg-[#4e4e4e] border border-gray-600 text-white text-sm rounded transition-colors">
                Sign In
            </button>
        </div>
    </div>

    <!-- 3. Desktop Environment (Ubuntu Gnome Style) -->
    <div id="desktop" class="absolute inset-0 z-0 hidden opacity-0 transition-opacity duration-1000 font-ubuntu">
        <!-- Wallpaper -->
        <div id="desktop-bg" class="absolute inset-0"></div>

        <!-- Top Bar -->
        <div class="absolute top-0 left-0 right-0 h-7 bg-[#1D1D1D] flex justify-between items-center px-3 text-sm text-gray-200 select-none z-50 shadow-md">
            <div class="flex items-center gap-4">
                <span class="font-bold hover:text-white cursor-pointer text-sm">Activities</span>
                <span id="active-app-name" class="text-gray-400 text-xs hidden md:block"></span>
            </div>
            <div class="absolute left-1/2 transform -translate-x-1/2 font-medium" id="top-clock">
                Oct 24 12:00
            </div>
            <div class="flex items-center gap-3">
                <div class="flex items-center gap-2" id="system-tray-icons">
                    <i data-lucide="network" class="w-3 h-3"></i>
                    <i data-lucide="volume-2" class="w-3 h-3"></i>
                    <i data-lucide="power" class="w-3 h-3"></i>
                </div>
                <div class="w-0 h-0 border-l-[5px] border-l-transparent border-r-[5px] border-r-transparent border-t-[5px] border-t-gray-400"></div>
            </div>
        </div>

        <!-- Left Dock (Sidebar) -->
        <div class="absolute top-7 bottom-0 left-0 w-16 bg-[#181818]/90 backdrop-blur-sm z-40 flex flex-col items-center py-2 gap-2 shadow-xl">
            <div id="dock-container" class="flex flex-col gap-3 w-full items-center">
                <!-- Dock Items injected here -->
            </div>
            <div class="mt-auto mb-2 w-10 h-10 rounded bg-white/10 flex items-center justify-center cursor-pointer hover:bg-white/20 transition-colors">
                 <i data-lucide="grid" class="w-6 h-6 text-white"></i>
            </div>
        </div>

        <!-- Desktop Icons Area -->
        <div id="desktop-icons" class="absolute top-10 left-20 flex flex-col gap-4 z-0">
            <!-- Icons generated by JS -->
        </div>

        <!-- Window Container -->
        <div id="window-container" class="absolute inset-0 pointer-events-none z-10 overflow-hidden">
            <!-- Windows -->
        </div>
    </div>

    <script>
        // --- System Config ---
        const CONFIG = {
            bootSpeed: 80,
            user: 'ubuntu',
            hostname: 'ubuntu-desktop',
            version: 'Ubuntu 24.04 LTS',
            kernel: 'Linux 6.8.0-generic'
        };

        // VFS
        const VFS = {
            '/': { type: 'dir', children: ['bin', 'boot', 'dev', 'etc', 'home', 'usr', 'var', 'root'] },
            '/bin': { type: 'dir', children: ['bash', 'ls', 'cat', 'ps', 'grep', 'apt'] },
            '/etc': { type: 'dir', children: ['os-release', 'hostname', 'passwd'] },
            '/home': { type: 'dir', children: ['ubuntu'] },
            '/home/ubuntu': { type: 'dir', children: ['Desktop', 'Documents', 'Downloads', 'Pictures', 'Public'] },
            '/home/ubuntu/Documents': { type: 'dir', children: ['todo.txt', 'project_plan.txt'] },
            '/home/ubuntu/Desktop': { type: 'dir', children: ['welcome.txt'] },
            '/home/ubuntu/welcome.txt': { type: 'file', content: 'Welcome to Ubuntu on Web!\nThis is a simulation powered by JavaScript.' },
            '/etc/os-release': { type: 'file', content: 'PRETTY_NAME="Ubuntu 24.04 LTS"\nNAME="Ubuntu"\nID=ubuntu\nID_LIKE=debian' }
        };

        const APPS = {
            terminal: {
                id: 'terminal',
                name: 'Terminal',
                icon: 'terminal',
                color: 'bg-[#3E3E3E]',
                component: createTerminalComponent,
                defaultSize: { w: 700, h: 450 }
            },
            files: {
                id: 'files',
                name: 'Files',
                icon: 'folder',
                color: 'bg-[#E95420]', // Ubuntu Orange
                component: createFilesComponent,
                defaultSize: { w: 800, h: 500 }
            },
            editor: {
                id: 'editor',
                name: 'Text Editor',
                icon: 'file-edit',
                color: 'bg-[#2C2C2C]',
                component: createEditorComponent,
                defaultSize: { w: 600, h: 400 }
            },
            settings: {
                id: 'settings',
                name: 'Settings',
                icon: 'settings',
                color: 'bg-[#5E2750]', // Ubuntu Aubergine
                component: createSettingsComponent,
                defaultSize: { w: 750, h: 550 }
            },
            browser: {
                id: 'browser',
                name: 'Firefox',
                icon: 'globe',
                color: 'bg-[#E66000]',
                component: createBrowserComponent,
                defaultSize: { w: 900, h: 600 }
            }
        };

        let state = {
            currentPath: '/home/ubuntu',
            commandHistory: [],
            historyIndex: -1,
            windows: [],
            nextZIndex: 100,
            clipboard: ''
        };

        // --- System Core ---

        const system = {
            init: () => {
                lucide.createIcons();
                system.runBootSequence();
                system.updateClock();
                setInterval(system.updateClock, 60000);
            },

            updateClock: () => {
                const now = new Date();
                const dateStr = now.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                const timeStr = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: false });
                document.getElementById('top-clock').innerText = `${dateStr}  ${timeStr}`;
            },

            runBootSequence: async () => {
                // Ubuntu style: Just the logo loading for a while, then login
                await new Promise(r => setTimeout(r, 2500));
                
                const bootScreen = document.getElementById('boot-screen');
                bootScreen.classList.add('opacity-0');
                setTimeout(() => {
                    bootScreen.classList.add('hidden');
                    system.showLogin();
                }, 500);
            },

            showLogin: () => {
                const loginScreen = document.getElementById('login-screen');
                loginScreen.classList.remove('hidden');
                void loginScreen.offsetWidth;
                loginScreen.classList.remove('opacity-0');
                document.getElementById('password-input').focus();
                
                document.getElementById('password-input').addEventListener('keypress', (e) => {
                    if(e.key === 'Enter') system.login();
                });
            },

            login: () => {
                const pwd = document.getElementById('password-input').value;
                const msg = document.getElementById('login-msg');
                
                if (!pwd) {
                    msg.innerText = "Sorry, that didn't work. Please try again.";
                    return;
                }

                // Simulate GDM fade out
                const loginScreen = document.getElementById('login-screen');
                loginScreen.style.opacity = 0;
                
                setTimeout(() => {
                    loginScreen.classList.add('hidden');
                    system.loadDesktop();
                }, 700);
            },

            loadDesktop: () => {
                const desktop = document.getElementById('desktop');
                desktop.classList.remove('hidden');
                void desktop.offsetWidth;
                desktop.classList.remove('opacity-0');

                system.renderDesktopIcons();
                system.renderDock();
                
                setTimeout(() => {
                    wm.openWindow('terminal');
                }, 800);
            },

            reboot: () => {
                location.reload();
            },

            renderDesktopIcons: () => {
                const container = document.getElementById('desktop-icons');
                const items = [
                    { app: 'files', label: 'Home', icon: 'home' },
                    { app: 'files', label: 'Trash', icon: 'trash-2' }
                ];

                items.forEach(item => {
                    const div = document.createElement('div');
                    div.className = "flex flex-col items-center gap-1 w-20 p-2 rounded hover:bg-white/10 cursor-pointer transition-colors group";
                    div.innerHTML = `
                        <div class="w-10 h-10 text-[#E95420] filter drop-shadow-md">
                            <i data-lucide="${item.icon}" width="40" height="40"></i>
                        </div>
                        <span class="text-white text-xs text-center drop-shadow font-medium">${item.label}</span>
                    `;
                    div.onclick = () => wm.openWindow(item.app);
                    container.appendChild(div);
                });
                lucide.createIcons();
            },

            renderDock: () => {
                const dock = document.getElementById('dock-container');
                Object.values(APPS).forEach(app => {
                    const btn = document.createElement('div');
                    btn.className = "w-10 h-10 rounded flex items-center justify-center relative group hover:bg-white/10 transition-colors cursor-pointer";
                    
                    // Dot indicator (Left side for Ubuntu dock usually, or dot)
                    btn.innerHTML = `
                        <div class="w-8 h-8 rounded bg-gradient-to-br from-gray-700 to-gray-800 flex items-center justify-center shadow-md relative">
                             <i data-lucide="${app.icon}" class="w-5 h-5 text-white"></i>
                        </div>
                        <div class="absolute left-[-4px] top-1/2 -translate-y-1/2 w-1 h-1 bg-[#E95420] rounded-full opacity-0 transition-opacity" id="dock-dot-${app.id}"></div>
                        
                        <!-- Tooltip -->
                        <div class="absolute left-12 bg-black/80 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none whitespace-nowrap border border-white/10 z-50">
                            ${app.name}
                        </div>
                    `;
                    btn.onclick = () => wm.openWindow(app.id);
                    dock.appendChild(btn);
                });
                lucide.createIcons();
            }
        };

        // --- Window Manager ---
        const wm = {
            openWindow: (appId) => {
                const app = APPS[appId];
                const winId = `win-${Date.now()}`;
                state.nextZIndex++;

                const dockDot = document.getElementById(`dock-dot-${appId}`);
                if(dockDot) {
                    dockDot.classList.remove('opacity-0');
                    dockDot.style.height = '6px'; 
                }

                const winEl = document.createElement('div');
                winEl.id = winId;
                winEl.className = "absolute flex flex-col rounded-lg overflow-hidden yaru-panel window-transition pointer-events-auto";
                winEl.style.width = `${app.defaultSize.w}px`;
                winEl.style.height = `${app.defaultSize.h}px`;
                winEl.style.zIndex = state.nextZIndex;
                
                const randX = 100 + Math.random() * 50;
                const randY = 60 + Math.random() * 50;
                winEl.style.left = `${randX}px`;
                winEl.style.top = `${randY}px`;

                // Ubuntu Title Bar (Controls on Right)
                const titleBar = document.createElement('div');
                titleBar.className = "h-9 yaru-header flex items-center justify-between px-3 cursor-default select-none";
                titleBar.innerHTML = `
                    <div class="flex items-center gap-2 flex-1 justify-center relative">
                        <span class="text-sm text-gray-300 font-bold absolute left-0">${app.name}</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <button class="w-6 h-6 rounded-full hover:bg-white/10 flex items-center justify-center text-gray-400" onclick="wm.minimizeWindow('${winId}')">
                            <i data-lucide="minus" class="w-3 h-3"></i>
                        </button>
                        <button class="w-6 h-6 rounded-full hover:bg-white/10 flex items-center justify-center text-gray-400" onclick="wm.maximizeWindow('${winId}')">
                            <i data-lucide="square" class="w-3 h-3"></i>
                        </button>
                        <button class="w-6 h-6 rounded-full hover:bg-[#E95420] hover:text-white flex items-center justify-center text-gray-400 transition-colors" onclick="wm.closeWindow('${winId}', '${appId}')">
                            <i data-lucide="x" class="w-3 h-3"></i>
                        </button>
                    </div>
                `;

                const content = document.createElement('div');
                content.className = "flex-1 relative overflow-hidden bg-[#1E1E1E]";
                content.appendChild(app.component(winId));

                winEl.appendChild(titleBar);
                winEl.appendChild(content);

                titleBar.addEventListener('mousedown', (e) => wm.startDrag(e, winEl));
                winEl.addEventListener('mousedown', () => wm.focusWindow(winEl, app.name));

                document.getElementById('window-container').appendChild(winEl);
                lucide.createIcons();
                wm.focusWindow(winEl, app.name);
                state.windows.push({ id: winId, appId: appId, el: winEl });
            },

            closeWindow: (winId, appId) => {
                const win = document.getElementById(winId);
                if (win) {
                    win.style.opacity = "0";
                    win.style.transform = "scale(0.95)";
                    setTimeout(() => {
                        win.remove();
                        state.windows = state.windows.filter(w => w.id !== winId);
                        if (!state.windows.find(w => w.appId === appId)) {
                            const dockDot = document.getElementById(`dock-dot-${appId}`);
                            if(dockDot) dockDot.classList.add('opacity-0');
                        }
                    }, 150);
                }
            },

            minimizeWindow: (winId) => {
                const win = document.getElementById(winId);
                win.style.opacity = "0";
                win.style.transform = "translateX(-100px) scale(0.5)";
                setTimeout(() => { win.style.display = 'none'; }, 200);
            },

            maximizeWindow: (winId) => {
                const win = document.getElementById(winId);
                if (win.dataset.maximized === "true") {
                    win.style.top = win.dataset.prevTop;
                    win.style.left = win.dataset.prevLeft;
                    win.style.width = win.dataset.prevWidth;
                    win.style.height = win.dataset.prevHeight;
                    win.style.borderRadius = "0.5rem";
                    win.dataset.maximized = "false";
                } else {
                    win.dataset.prevTop = win.style.top;
                    win.dataset.prevLeft = win.style.left;
                    win.dataset.prevWidth = win.style.width;
                    win.dataset.prevHeight = win.style.height;
                    win.style.top = "28px"; // Below Top Bar
                    win.style.left = "64px"; // Right of Dock
                    win.style.width = "calc(100% - 64px)";
                    win.style.height = "calc(100% - 28px)";
                    win.style.borderRadius = "0";
                    win.dataset.maximized = "true";
                }
            },

            focusWindow: (winEl, appName) => {
                state.nextZIndex++;
                winEl.style.zIndex = state.nextZIndex;
                document.getElementById('active-app-name').innerText = appName;
            },

            startDrag: (e, winEl) => {
                if (winEl.dataset.maximized === "true") return;
                e.preventDefault();
                const initialX = e.clientX - winEl.offsetLeft;
                const initialY = e.clientY - winEl.offsetTop;

                const onMove = (moveEvent) => {
                    winEl.style.left = `${moveEvent.clientX - initialX}px`;
                    winEl.style.top = `${moveEvent.clientY - initialY}px`;
                };
                const onUp = () => {
                    document.removeEventListener('mousemove', onMove);
                    document.removeEventListener('mouseup', onUp);
                };
                document.addEventListener('mousemove', onMove);
                document.addEventListener('mouseup', onUp);
            }
        };

        // --- App Components ---

        function createTerminalComponent(winId) {
            const container = document.createElement('div');
            container.className = "w-full h-full bg-[#300a24] p-2 font-mono text-sm text-gray-100 overflow-y-auto flex flex-col";
            
            const output = document.createElement('div');
            output.className = "flex-1 pb-2";
            output.innerHTML = `
                <div class="mb-1">Welcome to Ubuntu 24.04 LTS (GNU/Linux 6.8.0-generic x86_64)</div>
                <div class="mb-2 text-gray-400"> * Documentation:  https://help.ubuntu.com</div>
            `;

            const inputLine = document.createElement('div');
            inputLine.className = "flex items-center";
            inputLine.innerHTML = `
                <span class="text-[#87D441] font-bold mr-0">ubuntu@ubuntu-desktop</span>
                <span class="text-white mr-2">:</span>
                <span class="text-[#3465A4] font-bold mr-2">${state.currentPath}</span>
                <span class="text-white mr-2">$</span>
                <input type="text" class="flex-1 bg-transparent border-none outline-none text-white term-input" autocomplete="off" autofocus>
            `;

            container.appendChild(output);
            container.appendChild(inputLine);
            const input = inputLine.querySelector('input');

            container.addEventListener('click', () => {
                if(window.getSelection().toString() === '') input.focus();
            });

            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    const cmd = input.value;
                    processCommand(cmd, output, inputLine);
                    input.value = '';
                    container.scrollTop = container.scrollHeight;
                }
            });
            return container;
        }

        function createFilesComponent(winId) {
            const container = document.createElement('div');
            container.className = "w-full h-full flex bg-[#F7F7F7] text-[#333]";
            
            // Sidebar
            const sidebar = document.createElement('div');
            sidebar.className = "w-40 bg-[#2C2C2C] text-gray-300 flex flex-col gap-1 py-2 text-sm";
            
            const places = [
                { name: 'Home', path: '/home/ubuntu', icon: 'home' },
                { name: 'Desktop', path: '/home/ubuntu/Desktop', icon: 'monitor' },
                { name: 'Documents', path: '/home/ubuntu/Documents', icon: 'file-text' },
                { name: 'Trash', path: '/trash', icon: 'trash-2' }
            ];

            places.forEach(p => {
                const item = document.createElement('div');
                item.className = "flex items-center gap-3 px-4 py-2 hover:bg-[#E95420] hover:text-white cursor-pointer transition-colors";
                item.innerHTML = `<i data-lucide="${p.icon}" class="w-4 h-4"></i> ${p.name}`;
                item.onclick = () => loadDir(p.path);
                sidebar.appendChild(item);
            });

            // Main
            const main = document.createElement('div');
            main.className = "flex-1 flex flex-col bg-white";
            
            const toolbar = document.createElement('div');
            toolbar.className = "h-10 border-b border-gray-200 flex items-center px-4 text-sm bg-[#FAFAFA]";
            toolbar.innerText = "/home/ubuntu";

            const grid = document.createElement('div');
            grid.className = "flex-1 p-4 grid grid-cols-4 gap-4 content-start overflow-y-auto";

            main.appendChild(toolbar);
            main.appendChild(grid);
            container.appendChild(sidebar);
            container.appendChild(main);

            const loadDir = (path) => {
                toolbar.innerText = path;
                grid.innerHTML = '';
                const target = getFileObject(path);
                if(!target || target.type !== 'dir') return;

                target.children.forEach(childName => {
                    const isDir = childName.indexOf('.') === -1; // Simplified logic
                    const el = document.createElement('div');
                    el.className = "flex flex-col items-center gap-2 p-2 hover:bg-[#E95420]/10 rounded cursor-pointer";
                    el.innerHTML = `
                        <i data-lucide="${isDir ? 'folder' : 'file'}" class="w-12 h-12 ${isDir ? 'text-[#E95420]' : 'text-gray-400'} fill-current"></i>
                        <span class="text-xs text-center w-full truncate">${childName}</span>
                    `;
                    grid.appendChild(el);
                });
                lucide.createIcons();
            };

            loadDir('/home/ubuntu');
            return container;
        }

        function createEditorComponent(winId) {
            const area = document.createElement('textarea');
            area.className = "w-full h-full bg-white text-gray-800 p-4 font-mono text-sm border-none outline-none resize-none";
            area.value = "File is empty";
            return area;
        }

        function createSettingsComponent(winId) {
             const div = document.createElement('div');
             div.className = "flex h-full bg-[#F7F7F7]";
             div.innerHTML = `
                <div class="w-1/4 bg-white border-r border-gray-300 p-2">
                    <div class="p-2 bg-[#E95420] text-white rounded mb-2">Wi-Fi</div>
                    <div class="p-2 hover:bg-gray-100 rounded text-gray-700">Bluetooth</div>
                    <div class="p-2 hover:bg-gray-100 rounded text-gray-700">Appearance</div>
                    <div class="p-2 hover:bg-gray-100 rounded text-gray-700">Display</div>
                </div>
                <div class="flex-1 p-8">
                    <h2 class="text-2xl mb-4 text-gray-800">About</h2>
                    <div class="flex items-start gap-4">
                        <div class="w-20 h-20 bg-orange-500 rounded-full flex items-center justify-center text-white text-3xl font-bold">U</div>
                        <div>
                            <div class="text-xl font-bold text-gray-800">Ubuntu 24.04 LTS</div>
                            <div class="text-gray-600">OS Name: Ubuntu 24.04 LTS</div>
                            <div class="text-gray-600">OS Type: 64-bit</div>
                            <div class="text-gray-600">GNOME Version: 46</div>
                            <div class="text-gray-600">Windowing System: Wayland</div>
                        </div>
                    </div>
                </div>
             `;
             return div;
        }
        
        function createBrowserComponent(winId) {
             const div = document.createElement('div');
             div.className = "flex flex-col h-full bg-[#F0F0F4]";
             div.innerHTML = `
                 <div class="h-10 bg-[#F9F9FA] flex items-center px-2 gap-2 border-b border-gray-300 shadow-sm">
                     <div class="flex gap-1 text-gray-500">
                        <i data-lucide="arrow-left" class="w-4 h-4"></i>
                        <i data-lucide="rotate-cw" class="w-4 h-4"></i>
                     </div>
                     <div class="flex-1 bg-white border border-gray-300 rounded-md h-7 flex items-center px-2 text-sm text-gray-700">
                         google.com
                     </div>
                 </div>
                 <div class="flex-1 flex items-center justify-center text-gray-400">
                     <div class="text-center">
                        <h1 class="text-4xl font-bold text-gray-300 mb-2">Google</h1>
                        <input class="border rounded-full px-4 py-2 w-64" placeholder="Search">
                     </div>
                 </div>
             `;
             setTimeout(lucide.createIcons, 0);
             return div;
        }

        // --- Terminal Logic ---
        function getFileObject(path) {
            if(path.endsWith('/')) path = path.slice(0, -1);
            if(path === '') return VFS['/'];
            
            if(path.startsWith('/')) return VFS[path];
            const abs = `${state.currentPath}/${path}`.replace('//', '/');
            return VFS[abs];
        }

        function processCommand(rawCmd, outputDiv, inputLineDiv) {
            const trimmed = rawCmd.trim();
            if (!trimmed) return;
            
            const histLine = document.createElement('div');
            histLine.innerHTML = `
                <span class="text-[#87D441] font-bold">ubuntu@ubuntu-desktop</span>
                <span class="text-white">:</span>
                <span class="text-[#3465A4] font-bold">${state.currentPath}</span>
                <span class="text-white">$ ${trimmed}</span>
            `;
            outputDiv.appendChild(histLine);

            const args = trimmed.split(' ');
            const cmd = args[0];
            let response = '';

            switch(cmd) {
                case 'clear': outputDiv.innerHTML = ''; break;
                case 'pwd': response = state.currentPath; break;
                case 'whoami': response = 'ubuntu'; break;
                case 'ls': 
                    const target = getFileObject(state.currentPath);
                    if(target && target.children) {
                        response = target.children.map(f => 
                            `<span class="${f.indexOf('.')===-1 ? 'text-[#3465A4] font-bold' : 'text-white'} mr-4">${f}</span>`
                        ).join('');
                    }
                    break;
                case 'cd':
                    const newPath = args[1] || '/home/ubuntu';
                    // Basic cd logic simulation
                    if(newPath === '..') {
                        state.currentPath = state.currentPath.split('/').slice(0,-1).join('/') || '/';
                    } else {
                        state.currentPath = (state.currentPath === '/' ? '' : state.currentPath) + '/' + newPath;
                    }
                    inputLineDiv.querySelector('.text-[#3465A4]').innerText = state.currentPath;
                    break;
                case 'neofetch':
                    response = `
                        <div class="flex gap-4 font-mono text-xs text-white my-2">
                            <div class="text-[#E95420] font-bold">
            .-.
           (   )
        .--.|.|.--.
       (   .|.|.   )
        '--'   '--'
       (   )   (   )
        '-'     '-'
                            </div>
                            <div>
                                <div><span class="text-[#E95420] font-bold">ubuntu</span>@<span class="text-[#E95420] font-bold">ubuntu-desktop</span></div>
                                <div>-----------------------</div>
                                <div><span class="text-[#E95420] font-bold">OS</span>: Ubuntu 24.04 LTS x86_64</div>
                                <div><span class="text-[#E95420] font-bold">Host</span>: Web Simulation</div>
                                <div><span class="text-[#E95420] font-bold">Kernel</span>: ${CONFIG.kernel}</div>
                                <div><span class="text-[#E95420] font-bold">Uptime</span>: ${(performance.now()/60000).toFixed(0)} mins</div>
                                <div><span class="text-[#E95420] font-bold">Packages</span>: 1337 (dpkg)</div>
                                <div><span class="text-[#E95420] font-bold">Shell</span>: bash 5.2.15</div>
                                <div><span class="text-[#E95420] font-bold">DE</span>: GNOME 46</div>
                                <div><span class="text-[#E95420] font-bold">Theme</span>: Yaru-dark [GTK3]</div>
                                <div><span class="text-[#E95420] font-bold">Icons</span>: Yaru [GTK3]</div>
                                <div class="mt-2 flex gap-1">
                                    <span class="w-3 h-3 bg-black block"></span>
                                    <span class="w-3 h-3 bg-[#E95420] block"></span>
                                    <span class="w-3 h-3 bg-[#5E2750] block"></span>
                                    <span class="w-3 h-3 bg-[#AEA79F] block"></span>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                case 'sudo': response = "sudo: sorry, you must have a valid terminal session to use sudo"; break;
                default: response = `${cmd}: command not found`;
            }

            if (response && cmd !== 'clear') {
                const respDiv = document.createElement('div');
                respDiv.className = "mb-2 text-gray-300";
                respDiv.innerHTML = response;
                outputDiv.appendChild(respDiv);
            }
        }

        window.onload = system.init;
    </script>
</body>
</html>