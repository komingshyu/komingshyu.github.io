<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é»é™£åœ–åƒä½å…ƒæ·±åº¦æ¯”è¼ƒæ•™å­¸å·¥å…·</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft JhengHei', 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }

        header p {
            font-size: 1.2em;
            opacity: 0.95;
        }

        .upload-section {
            padding: 40px;
            background: #f8f9fa;
            border-bottom: 3px solid #e9ecef;
        }

        .upload-area {
            border: 3px dashed #667eea;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .upload-area:hover {
            border-color: #764ba2;
            background: #f8f6ff;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
        }

        .upload-area.dragover {
            background: #e8e6ff;
            border-color: #764ba2;
        }

        .upload-icon {
            font-size: 3em;
            color: #667eea;
            margin-bottom: 15px;
        }

        .upload-text {
            font-size: 1.2em;
            color: #495057;
            margin-bottom: 10px;
        }

        .upload-hint {
            font-size: 0.9em;
            color: #6c757d;
        }

        #fileInput {
            display: none;
        }

        .info-panel {
            padding: 30px;
            background: #fff3cd;
            border-left: 5px solid #ffc107;
            margin: 20px 40px;
            border-radius: 5px;
            display: none;
        }

        .info-panel.show {
            display: block;
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }

        .info-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .info-label {
            font-size: 0.9em;
            color: #6c757d;
            margin-bottom: 5px;
        }

        .info-value {
            font-size: 1.3em;
            font-weight: bold;
            color: #495057;
        }

        .bit-depth-badge {
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.9em;
            margin-left: 10px;
            font-weight: normal;
        }

        .comparison-section {
            padding: 40px;
            display: none;
        }

        .comparison-section.show {
            display: block;
        }

        .rgb-section {
            padding: 40px;
            background: #f8f9fa;
            display: none;
            border-top: 3px solid #e9ecef;
        }

        .rgb-section.show {
            display: block;
        }

        .section-title {
            font-size: 1.8em;
            color: #495057;
            margin-bottom: 30px;
            text-align: center;
            position: relative;
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 3px;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 2px;
        }

        .image-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-top: 40px;
        }

        .rgb-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 30px;
            margin-top: 40px;
        }

        .image-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            position: relative;
        }

        .image-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        }

        .image-card.original {
            border: 3px solid #28a745;
        }

        .image-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            font-weight: bold;
            font-size: 1.1em;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .image-header.original {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        }

        .image-header.red {
            background: linear-gradient(135deg, #ff4444 0%, #cc0000 100%);
        }

        .image-header.green {
            background: linear-gradient(135deg, #44ff44 0%, #00cc00 100%);
        }

        .image-header.blue {
            background: linear-gradient(135deg, #4444ff 0%, #0000cc 100%);
        }

        .image-container {
            padding: 15px;
            background: #f8f9fa;
            min-height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .image-container canvas {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .image-info {
            padding: 15px;
            background: white;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #e9ecef;
        }

        .info-row:last-child {
            border-bottom: none;
        }

        .info-label {
            color: #6c757d;
            font-size: 0.9em;
        }

        .info-value {
            font-weight: bold;
            color: #495057;
        }

        .loading {
            display: inline-block;
            width: 30px;
            height: 30px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .legend {
            background: #e8f4fd;
            border: 1px solid #bee5eb;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 40px;
        }

        .legend h3 {
            color: #0c5460;
            margin-bottom: 15px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin: 10px 0;
        }

        .legend-color {
            width: 30px;
            height: 30px;
            border-radius: 5px;
            margin-right: 15px;
            border: 2px solid #dee2e6;
        }

        .legend-text {
            color: #495057;
        }

        .zoom-controls {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 5px;
            background: white;
            border-radius: 5px;
            padding: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .zoom-btn {
            width: 30px;
            height: 30px;
            border: none;
            background: #667eea;
            color: white;
            border-radius: 3px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .zoom-btn:hover {
            background: #764ba2;
        }

        @media (max-width: 768px) {
            header h1 {
                font-size: 1.8em;
            }

            .image-grid, .rgb-grid {
                grid-template-columns: 1fr;
            }

            .info-grid {
                grid-template-columns: 1fr;
            }
        }

        .tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 8px 12px;
            border-radius: 5px;
            font-size: 0.9em;
            pointer-events: none;
            z-index: 1000;
            display: none;
        }

        .rgb-explanation {
            background: #e7f3ff;
            border: 1px solid #b3d9ff;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 40px;
            text-align: center;
        }

        .rgb-explanation h3 {
            color: #0066cc;
            margin-bottom: 15px;
        }

        .rgb-explanation p {
            color: #495057;
            line-height: 1.6;
        }

        .channel-icon {
            display: inline-block;
            width: 20px;
            height: 20px;
            border-radius: 3px;
            margin-right: 8px;
            vertical-align: middle;
        }

        .icon-red { background: #ff0000; }
        .icon-green { background: #00ff00; }
        .icon-blue { background: #0000ff; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ¨ é»é™£åœ–åƒä½å…ƒæ·±åº¦æ¯”è¼ƒæ•™å­¸å·¥å…·</h1>
            <p>æ¢ç´¢ä¸åŒä½å…ƒæ·±åº¦å°åœ–åƒå“è³ªèˆ‡æª”æ¡ˆå¤§å°çš„å½±éŸ¿</p>
        </header>

        <section class="upload-section">
            <div class="upload-area" id="uploadArea">
                <div class="upload-icon">ğŸ“</div>
                <div class="upload-text">é»æ“Šä¸Šå‚³åœ–ç‰‡æˆ–æ‹–æ›³è‡³æ­¤è™•</div>
                <div class="upload-hint">æ”¯æ´ JPG, PNG, GIF æ ¼å¼</div>
                <input type="file" id="fileInput" accept="image/*">
            </div>

            <div class="info-panel" id="originalInfo">
                <h3>ğŸ“Š åŸå§‹åœ–ç‰‡è³‡è¨Š</h3>
                <div class="info-grid">
                    <div class="info-item">
                        <div class="info-label">æª”æ¡ˆåç¨±</div>
                        <div class="info-value" id="fileName">-</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">åŸå§‹æª”æ¡ˆå¤§å°</div>
                        <div class="info-value" id="originalSize">-</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">åœ–ç‰‡è§£æåº¦</div>
                        <div class="info-value" id="resolution">-</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">ç¸½åƒç´ æ•¸</div>
                        <div class="info-value" id="totalPixels">-</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">åµæ¸¬ä½å…ƒæ·±åº¦</div>
                        <div class="info-value" id="detectedBitDepth">-</div>
                    </div>
                </div>
            </div>
        </section>

        <div class="legend">
            <h3>ğŸ“š ä½å…ƒæ·±åº¦èªªæ˜</h3>
            <div class="legend-item">
                <div class="legend-color" style="background: #000000;"></div>
                <div class="legend-text"><strong>1ä½å…ƒï¼š</strong>é»‘ç™½2è‰²ï¼ˆå–®è‰²åœ–åƒï¼‰</div>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: linear-gradient(90deg, #000, #fff);"></div>
                <div class="legend-text"><strong>8ä½å…ƒç°éšï¼š</strong>256ç´šç°éš</div>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: linear-gradient(90deg, #ff0000, #00ff00, #0000ff);"></div>
                <div class="legend-text"><strong>8ä½å…ƒå½©è‰²ï¼š</strong>256è‰²ï¼ˆç´¢å¼•è‰²ï¼‰</div>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: linear-gradient(90deg, #ff0000, #00ff00, #0000ff, #ffff00);"></div>
                <div class="legend-text"><strong>16ä½å…ƒå½©è‰²ï¼š</strong>65,536è‰²ï¼ˆé«˜å½©è‰²ï¼‰</div>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: linear-gradient(90deg, #ff0000, #00ff00, #0000ff, #ffff00, #ff00ff);"></div>
                <div class="legend-text"><strong>24ä½å…ƒå½©è‰²ï¼š</strong>1,670è¬è‰²ï¼ˆçœŸå½©è‰²ï¼‰</div>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: linear-gradient(90deg, rgba(255,0,0,0.5), rgba(0,255,0,0.5), rgba(0,0,255,0.5));"></div>
                <div class="legend-text"><strong>32ä½å…ƒå½©è‰²ï¼š</strong>åŒ…å«é€æ˜é€šé“</div>
            </div>
        </div>

        <section class="comparison-section" id="comparisonSection">
            <h2 class="section-title">ğŸ” ä¸åŒä½å…ƒæ·±åº¦æ¯”è¼ƒ</h2>
            <div class="image-grid" id="imageGrid">
                <!-- åœ–ç‰‡å¡ç‰‡å°‡ç”±JavaScriptå‹•æ…‹ç”Ÿæˆ -->
            </div>
        </section>

        <section class="rgb-section" id="rgbSection">
            <div class="rgb-explanation">
                <h3>ğŸŒˆ RGBè‰²å½©é€šé“åˆ†é›¢</h3>
                <p>
                    æ•¸ä½åœ–åƒç”±ç´…(R)ã€ç¶ (G)ã€è—(B)ä¸‰å€‹é¡è‰²é€šé“çµ„æˆã€‚<br>
                    æ¯å€‹é€šé“è¨˜éŒ„è©²é¡è‰²çš„å¼·åº¦ï¼Œä¸‰å€‹é€šé“ç–ŠåŠ å½¢æˆå®Œæ•´çš„å½©è‰²åœ–åƒã€‚<br>
                    <span class="channel-icon icon-red"></span>ç´…è‰²é€šé“ï¼šè¨˜éŒ„ç´…è‰²æˆåˆ†<br>
                    <span class="channel-icon icon-green"></span>ç¶ è‰²é€šé“ï¼šè¨˜éŒ„ç¶ è‰²æˆåˆ†<br>
                    <span class="channel-icon icon-blue"></span>è—è‰²é€šé“ï¼šè¨˜éŒ„è—è‰²æˆåˆ†
                </p>
            </div>
            <h2 class="section-title">ğŸ¨ RGBé€šé“åˆ†æ</h2>
            <div class="rgb-grid" id="rgbGrid">
                <!-- RGBé€šé“å¡ç‰‡å°‡ç”±JavaScriptå‹•æ…‹ç”Ÿæˆ -->
            </div>
        </section>
    </div>

    <div class="tooltip" id="tooltip"></div>

    <script>
        class ImageConverter {
            constructor() {
                this.originalImage = null;
                this.originalCanvas = null;
                this.originalCtx = null;
                this.detectedBitDepth = 24;
                this.init();
            }

            init() {
                this.setupEventListeners();
            }

            setupEventListeners() {
                const uploadArea = document.getElementById('uploadArea');
                const fileInput = document.getElementById('fileInput');

                uploadArea.addEventListener('click', () => fileInput.click());
                
                uploadArea.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    uploadArea.classList.add('dragover');
                });

                uploadArea.addEventListener('dragleave', () => {
                    uploadArea.classList.remove('dragover');
                });

                uploadArea.addEventListener('drop', (e) => {
                    e.preventDefault();
                    uploadArea.classList.remove('dragover');
                    const files = e.dataTransfer.files;
                    if (files.length > 0) {
                        this.handleFile(files[0]);
                    }
                });

                fileInput.addEventListener('change', (e) => {
                    if (e.target.files.length > 0) {
                        this.handleFile(e.target.files[0]);
                    }
                });
            }

            handleFile(file) {
                if (!file.type.startsWith('image/')) {
                    this.showMessage('è«‹ä¸Šå‚³åœ–ç‰‡æª”æ¡ˆï¼');
                    return;
                }

                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    img.onload = () => {
                        this.originalImage = img;
                        this.detectBitDepth(file, img);
                        this.displayOriginalInfo(file, img);
                        this.processImage();
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            }

            detectBitDepth(file, img) {
                // å‰µå»ºä¸€å€‹è‡¨æ™‚canvasä¾†è®€å–åƒç´ æ•¸æ“š
                const tempCanvas = document.createElement('canvas');
                const tempCtx = tempCanvas.getContext('2d');
                tempCanvas.width = img.width;
                tempCanvas.height = img.height;
                tempCtx.drawImage(img, 0, 0);

                const imageData = tempCtx.getImageData(0, 0, tempCanvas.width, tempCanvas.height);
                const data = imageData.data;
                
                // æª¢æŸ¥æ˜¯å¦æœ‰é€æ˜é€šé“
                let hasAlpha = false;
                for (let i = 3; i < data.length; i += 4) {
                    if (data[i] < 255) {
                        hasAlpha = true;
                        break;
                    }
                }

                // æª¢æŸ¥æ˜¯å¦ç‚ºç°éšåœ–åƒ
                let isGrayscale = true;
                for (let i = 0; i < data.length; i += 4) {
                    if (data[i] !== data[i + 1] || data[i] !== data[i + 2]) {
                        isGrayscale = false;
                        break;
                    }
                }

                // æ ¹æ“šæª”æ¡ˆé¡å‹å’Œæª¢æ¸¬çµæœåˆ¤æ–·ä½å…ƒæ·±åº¦
                if (file.type === 'image/png') {
                    if (hasAlpha) {
                        this.detectedBitDepth = 32;
                    } else if (isGrayscale) {
                        this.detectedBitDepth = 8;
                    } else {
                        this.detectedBitDepth = 24;
                    }
                } else if (file.type === 'image/jpeg') {
                    this.detectedBitDepth = 24;
                } else if (file.type === 'image/gif') {
                    this.detectedBitDepth = 8;
                } else {
                    // é è¨­å€¼
                    this.detectedBitDepth = hasAlpha ? 32 : 24;
                }
            }

            displayOriginalInfo(file, img) {
                document.getElementById('fileName').textContent = file.name;
                document.getElementById('originalSize').textContent = this.formatFileSize(file.size);
                document.getElementById('resolution').textContent = `${img.width} Ã— ${img.height}`;
                document.getElementById('totalPixels').textContent = (img.width * img.height).toLocaleString();
                document.getElementById('detectedBitDepth').textContent = `${this.detectedBitDepth} ä½å…ƒ`;
                document.getElementById('originalInfo').classList.add('show');
            }

            formatFileSize(bytes) {
                if (bytes < 1024) return bytes + ' B';
                if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(2) + ' KB';
                return (bytes / (1024 * 1024)).toFixed(2) + ' MB';
            }

            processImage() {
                this.originalCanvas = document.createElement('canvas');
                this.originalCtx = this.originalCanvas.getContext('2d');
                
                // é™åˆ¶æœ€å¤§å°ºå¯¸ä»¥æå‡è™•ç†é€Ÿåº¦
                const maxWidth = 800;
                const maxHeight = 600;
                let width = this.originalImage.width;
                let height = this.originalImage.height;

                if (width > maxWidth || height > maxHeight) {
                    const ratio = Math.min(maxWidth / width, maxHeight / height);
                    width *= ratio;
                    height *= ratio;
                }

                this.originalCanvas.width = width;
                this.originalCanvas.height = height;
                this.originalCtx.drawImage(this.originalImage, 0, 0, width, height);

                this.generateComparisons();
                this.generateRGBSeparation();
                document.getElementById('comparisonSection').classList.add('show');
                document.getElementById('rgbSection').classList.add('show');
            }

            generateComparisons() {
                const imageGrid = document.getElementById('imageGrid');
                imageGrid.innerHTML = '';

                // å…ˆé¡¯ç¤ºåŸå§‹åœ–åƒ
                const originalCard = this.createOriginalCard();
                imageGrid.appendChild(originalCard);

                const conversions = [
                    { name: '2ä½å…ƒåœ–åƒ', bits: 2, type: 'monochrome' },
                    { name: '8ä½å…ƒç°éš', bits: 8, type: 'grayscale' },
                    { name: '8ä½å…ƒå½©è‰²', bits: 8, type: 'indexed' },
                    { name: '16ä½å…ƒå½©è‰²', bits: 16, type: 'color' },
                    { name: '24ä½å…ƒå½©è‰²', bits: 24, type: 'color' },
                    { name: '32ä½å…ƒå½©è‰²', bits: 32, type: 'color' }
                ];

                conversions.forEach((config, index) => {
                    setTimeout(() => {
                        const card = this.createImageCard(config);
                        imageGrid.appendChild(card);
                    }, (index + 1) * 100);
                });
            }

            generateRGBSeparation() {
                const rgbGrid = document.getElementById('rgbGrid');
                rgbGrid.innerHTML = '';

                const channels = [
                    { name: 'ç´…è‰²é€šé“ (R)', type: 'red', color: '#ff0000' },
                    { name: 'ç¶ è‰²é€šé“ (G)', type: 'green', color: '#00ff00' },
                    { name: 'è—è‰²é€šé“ (B)', type: 'blue', color: '#0000ff' }
                ];

                channels.forEach((channel, index) => {
                    setTimeout(() => {
                        const card = this.createRGBCard(channel);
                        rgbGrid.appendChild(card);
                    }, index * 150);
                });
            }

            createOriginalCard() {
                const card = document.createElement('div');
                card.className = 'image-card original';
                card.style.animation = 'slideIn 0.5s ease';

                const canvas = document.createElement('canvas');
                canvas.width = this.originalCanvas.width;
                canvas.height = this.originalCanvas.height;
                const ctx = canvas.getContext('2d');
                ctx.drawImage(this.originalCanvas, 0, 0);

                card.innerHTML = `
                    <div class="image-header original">
                        <span>åŸå§‹åœ–åƒ</span>
                        <span class="bit-depth-badge">${this.detectedBitDepth} ä½å…ƒ</span>
                    </div>
                    <div class="image-container">
                        <canvas id="canvas-original" width="${canvas.width}" height="${canvas.height}"></canvas>
                        <div class="zoom-controls">
                            <button class="zoom-btn" onclick="imageConverter.zoomCanvas('original', 1.2)">+</button>
                            <button class="zoom-btn" onclick="imageConverter.zoomCanvas('original', 0.8)">-</button>
                        </div>
                    </div>
                    <div class="image-info">
                        <div class="info-row">
                            <span class="info-label">å¯¦éš›æª”æ¡ˆå¤§å°</span>
                            <span class="info-value">${document.getElementById('originalSize').textContent}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">åµæ¸¬ä½å…ƒæ·±åº¦</span>
                            <span class="info-value">${this.detectedBitDepth} bits</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">åœ–åƒé¡å‹</span>
                            <span class="info-value">${this.getImageType()}</span>
                        </div>
                    </div>
                `;

                setTimeout(() => {
                    const targetCanvas = document.getElementById('canvas-original');
                    const targetCtx = targetCanvas.getContext('2d');
                    targetCtx.drawImage(canvas, 0, 0);
                }, 50);

                return card;
            }

            createRGBCard(channel) {
                const card = document.createElement('div');
                card.className = 'image-card';
                card.style.animation = 'slideIn 0.5s ease';

                const canvas = this.separateRGBChannel(channel.type);
                const avgIntensity = this.calculateAverageIntensity(canvas, channel.type);

                card.innerHTML = `
                    <div class="image-header ${channel.type}">
                        <span>${channel.name}</span>
                    </div>
                    <div class="image-container">
                        <canvas id="canvas-${channel.type}" width="${canvas.width}" height="${canvas.height}"></canvas>
                        <div class="zoom-controls">
                            <button class="zoom-btn" onclick="imageConverter.zoomCanvas('${channel.type}', 1.2)">+</button>
                            <button class="zoom-btn" onclick="imageConverter.zoomCanvas('${channel.type}', 0.8)">-</button>
                        </div>
                    </div>
                    <div class="image-info">
                        <div class="info-row">
                            <span class="info-label">é€šé“é¡è‰²</span>
                            <span class="info-value" style="color: ${channel.color};">${channel.color.toUpperCase()}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">å¹³å‡å¼·åº¦</span>
                            <span class="info-value">${avgIntensity}%</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">ä½å…ƒæ·±åº¦</span>
                            <span class="info-value">8 bits</span>
                        </div>
                    </div>
                `;

                setTimeout(() => {
                    const targetCanvas = document.getElementById(`canvas-${channel.type}`);
                    const targetCtx = targetCanvas.getContext('2d');
                    targetCtx.drawImage(canvas, 0, 0);
                }, 50);

                return card;
            }

            separateRGBChannel(channelType) {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                canvas.width = this.originalCanvas.width;
                canvas.height = this.originalCanvas.height;

                const imageData = this.originalCtx.getImageData(0, 0, canvas.width, canvas.height);
                const data = imageData.data;
                const newData = ctx.createImageData(canvas.width, canvas.height);

                for (let i = 0; i < data.length; i += 4) {
                    if (channelType === 'red') {
                        newData.data[i] = data[i];     // R
                        newData.data[i + 1] = 0;        // G = 0
                        newData.data[i + 2] = 0;        // B = 0
                    } else if (channelType === 'green') {
                        newData.data[i] = 0;            // R = 0
                        newData.data[i + 1] = data[i + 1]; // G
                        newData.data[i + 2] = 0;        // B = 0
                    } else if (channelType === 'blue') {
                        newData.data[i] = 0;            // R = 0
                        newData.data[i + 1] = 0;        // G = 0
                        newData.data[i + 2] = data[i + 2]; // B
                    }
                    newData.data[i + 3] = 255;          // Alpha = 255
                }

                ctx.putImageData(newData, 0, 0);
                return canvas;
            }

            calculateAverageIntensity(canvas, channelType) {
                const ctx = canvas.getContext('2d');
                const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                const data = imageData.data;
                
                let totalIntensity = 0;
                let pixelCount = 0;

                for (let i = 0; i < data.length; i += 4) {
                    if (channelType === 'red') {
                        totalIntensity += data[i];
                    } else if (channelType === 'green') {
                        totalIntensity += data[i + 1];
                    } else if (channelType === 'blue') {
                        totalIntensity += data[i + 2];
                    }
                    pixelCount++;
                }

                const average = totalIntensity / pixelCount;
                return Math.round((average / 255) * 100);
            }

            getImageType() {
                if (this.detectedBitDepth === 2) return 'å–®è‰²';
                if (this.detectedBitDepth === 8) return 'ç°éš/ç´¢å¼•è‰²';
                if (this.detectedBitDepth === 16) return 'é«˜å½©è‰²';
                if (this.detectedBitDepth === 24) return 'çœŸå½©è‰²';
                if (this.detectedBitDepth === 32) return 'çœŸå½©è‰²+é€æ˜';
                return 'æœªçŸ¥';
            }

            createImageCard(config) {
                const card = document.createElement('div');
                card.className = 'image-card';
                card.style.animation = 'slideIn 0.5s ease';

                const canvas = this.convertImage(config);
                const fileSize = this.calculateFileSize(canvas, config.bits);

                card.innerHTML = `
                    <div class="image-header">${config.name}</div>
                    <div class="image-container">
                        <canvas id="canvas-${config.bits}-${config.type}" width="${canvas.width}" height="${canvas.height}"></canvas>
                        <div class="zoom-controls">
                            <button class="zoom-btn" onclick="imageConverter.zoomCanvas('${config.bits}-${config.type}', 1.2)">+</button>
                            <button class="zoom-btn" onclick="imageConverter.zoomCanvas('${config.bits}-${config.type}', 0.8)">-</button>
                        </div>
                    </div>
                    <div class="image-info">
                        <div class="info-row">
                            <span class="info-label">ç†è«–æª”æ¡ˆå¤§å°</span>
                            <span class="info-value">${fileSize}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">é¡è‰²æ•¸é‡</span>
                            <span class="info-value">${this.getColorCount(config)}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">æ¯åƒç´ ä½å…ƒæ•¸</span>
                            <span class="info-value">${config.bits} bits</span>
                        </div>
                    </div>
                `;

                // å°‡è½‰æ›å¾Œçš„åœ–åƒç¹ªè£½åˆ°å¡ç‰‡ä¸­çš„canvas
                setTimeout(() => {
                    const targetCanvas = document.getElementById(`canvas-${config.bits}-${config.type}`);
                    const targetCtx = targetCanvas.getContext('2d');
                    targetCtx.drawImage(canvas, 0, 0);
                }, 50);

                return card;
            }

            convertImage(config) {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                canvas.width = this.originalCanvas.width;
                canvas.height = this.originalCanvas.height;

                const imageData = this.originalCtx.getImageData(0, 0, canvas.width, canvas.height);
                const data = imageData.data;
                const newData = ctx.createImageData(canvas.width, canvas.height);

                for (let i = 0; i < data.length; i += 4) {
                    let r, g, b, a;

                    if (config.type === 'monochrome') {
                        // 2ä½å…ƒé»‘ç™½
                        const gray = Math.round(0.299 * data[i] + 0.587 * data[i + 1] + 0.114 * data[i + 2]);
                        const value = gray > 127 ? 255 : 0;
                        r = g = b = value;
                        a = 255;
                    } else if (config.type === 'grayscale') {
                        // 8ä½å…ƒç°éš
                        const gray = Math.round(0.299 * data[i] + 0.587 * data[i + 1] + 0.114 * data[i + 2]);
                        r = g = b = gray;
                        a = 255;
                    } else if (config.type === 'indexed') {
                        // 8ä½å…ƒå½©è‰²ï¼ˆä½¿ç”¨ç°¡å–®çš„é‡åŒ–ï¼‰
                        r = Math.round(data[i] / 255 * 7) * 36;
                        g = Math.round(data[i + 1] / 255 * 7) * 36;
                        b = Math.round(data[i + 2] / 255 * 3) * 85;
                        a = 255;
                    } else {
                        // 16/24/32ä½å…ƒå½©è‰²
                        const levels = Math.pow(2, config.bits / 3);
                        r = Math.round(data[i] / 255 * (levels - 1)) / (levels - 1) * 255;
                        g = Math.round(data[i + 1] / 255 * (levels - 1)) / (levels - 1) * 255;
                        b = Math.round(data[i + 2] / 255 * (levels - 1)) / (levels - 1) * 255;
                        a = config.bits === 32 ? data[i + 3] : 255;
                    }

                    newData.data[i] = r;
                    newData.data[i + 1] = g;
                    newData.data[i + 2] = b;
                    newData.data[i + 3] = a;
                }

                ctx.putImageData(newData, 0, 0);
                return canvas;
            }

            calculateFileSize(canvas, bits) {
                const totalPixels = canvas.width * canvas.height;
                const totalBits = totalPixels * bits;
                const totalBytes = totalBits / 8;
                return this.formatFileSize(totalBytes);
            }

            getColorCount(config) {
                if (config.type === 'monochrome') {
                    return '2è‰²';
                } else if (config.type === 'grayscale') {
                    return '256ç´šç°éš';
                } else if (config.type === 'indexed') {
                    return '256è‰²';
                } else {
                    return Math.pow(2, config.bits).toLocaleString() + 'è‰²';
                }
            }

            zoomCanvas(id, factor) {
                const canvas = document.getElementById(`canvas-${id}`);
                if (!canvas) return;

                const currentScale = canvas.style.transform ? 
                    parseFloat(canvas.style.transform.replace('scale(', '').replace(')', '')) : 1;
                const newScale = Math.max(0.5, Math.min(3, currentScale * factor));
                
                canvas.style.transform = `scale(${newScale})`;
                canvas.style.transformOrigin = 'center';
            }

            showMessage(message) {
                const tooltip = document.getElementById('tooltip');
                tooltip.textContent = message;
                tooltip.style.display = 'block';
                tooltip.style.left = '50%';
                tooltip.style.top = '50%';
                tooltip.style.transform = 'translate(-50%, -50%)';
                
                setTimeout(() => {
                    tooltip.style.display = 'none';
                }, 3000);
            }
        }

        // åˆå§‹åŒ–æ‡‰ç”¨ç¨‹å¼
        const imageConverter = new ImageConverter();
    </script>

</body></html>