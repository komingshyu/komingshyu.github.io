<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çç‹€å¥—å°ç³»çµ±</title>
    <style>
        body {
            font-family: "DFKai-SB", Arial, sans-serif;
            display: flex;
            background-color: #f4f4f4;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        #settings {
            width: 36%;
            padding: 25px;
            background-color: #fff;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.2);
            margin-right: 20px;
            overflow-y: auto;
            max-height: 95vh;
        }
        #preview {
            width: 210mm;
            position: relative;
            background-color: #fff;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.2);
            overflow: hidden;
        }
        #canvas {
            width: 210mm;
            height: 297mm;
            position: absolute;
            top: 0;
            left: 0;
            border: 1px solid #e0e0e0;
            background-color: rgba(255, 255, 255, 0.8);
        }
        #imagePreview {
            width: 210mm;
            height: 297mm;
            position: absolute;
            top: 0;
            left: 0;
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
        }
        .text-input {
            margin-bottom: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #007bff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .text-input:nth-child(odd) {
            background-color: #f0f4f8;
        }
        input[type="text"] {
            width: calc(100% - 20px);
            padding: 12px;
            margin: 8px 0;
            border: 1px solid #ddd;
            border-radius: 6px;
            background-color: #fff;
            font-size: 16px;
            transition: all 0.3s;
        }
        input[type="text"]:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0,123,255,0.1);
        }
        input[type="number"] {
            width: 55px;
            padding: 8px;
            margin: 5px 8px 5px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            text-align: center;
        }
        label {
            font-weight: bold;
            color: #333;
            margin-right: 5px;
        }
        .input-group {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 8px;
        }
        button {
            padding: 12px 20px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            margin: 5px;
            transition: all 0.3s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        button:hover {
            background-color: #218838;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        button:active {
            transform: translateY(0);
        }
        #exportPDF {
            background-color: #dc3545;
        }
        #exportPDF:hover {
            background-color: #c82333;
        }
        #loadDemo {
            background-color: #17a2b8;
        }
        #loadDemo:hover {
            background-color: #138496;
        }
        #saveSettings {
            background-color: #007bff;
        }
        #saveSettings:hover {
            background-color: #0056b3;
        }
        #resetSettings {
            background-color: #ffc107;
            color: #212529;
        }
        #resetSettings:hover {
            background-color: #e0a800;
        }
        h2 {
            color: #333;
            border-bottom: 3px solid #007bff;
            padding-bottom: 10px;
            margin-top: 0;
            text-align: center;
        }
        .button-group {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            margin-top: 20px;
        }
        .file-input-wrapper {
            margin-bottom: 20px;
            text-align: center;
        }
        .file-input-wrapper input[type="file"] {
            width: 100%;
            padding: 10px;
            border: 2px dashed #007bff;
            border-radius: 6px;
            background-color: #f8f9fa;
        }
        select {
            padding: 10px;
            border-radius: 6px;
            border: 1px solid #ddd;
            font-size: 16px;
            margin: 10px 0;
            width: 100%;
        }
        .section-title {
            font-size: 18px;
            font-weight: bold;
            margin: 25px 0 15px 0;
            color: #007bff;
        }
    </style>
</head>
<body>

<div id="settings">
    <h2>ğŸ† çç‹€å¥—å°ç³»çµ± ğŸ†</h2>
    
    <div class="file-input-wrapper">
        <label for="imageInput"><strong>ä¸Šå‚³çç‹€èƒŒæ™¯åœ–ç‰‡ï¼š</strong></label><br>
        <input type="file" id="imageInput" accept="image/*">
    </div>
    
    <div class="section-title">å­—é«”è¨­å®š</div>
    <label for="fontSelect">é¸æ“‡å­—é«”ï¼š</label>
    <select id="fontSelect">
        <option value="DFKai-SB">æ¨™æ¥·é«”</option>
        <option value="Microsoft JhengHei">å¾®è»Ÿæ­£é»‘é«”</option>
        <option value="MingLiU">ç´°æ˜é«”</option>
    </select>

    <!-- 6çµ„æ–‡å­—è¼¸å…¥å€ -->
    <div class="section-title">æ–‡å­—å…§å®¹èˆ‡ä½ç½®è¨­å®š</div>
    
    <div class="text-input">
        <label>ç¬¬1åˆ—æ–‡å­—</label>
        <div class="input-group">
            <label>Xåº§æ¨™</label>
            <input type="number" class="xCoord" value="123">
            <label>Yåº§æ¨™</label>
            <input type="number" class="yCoord" value="490">
            <label>å­—å‹å¤§å°</label>
            <input type="number" class="fontSize" value="39">
        </div>
        <input type="text" class="textInput" placeholder="è¼¸å…¥æ–‡å­—" value="èˆ‰è¾¦é …ç›®ï¼šç¬¬ä¸€æ¬¡æ®µè€ƒ">
    </div>
    <div class="text-input">
        <label>ç¬¬2åˆ—æ–‡å­—</label>
        <div class="input-group">
            <label>Xåº§æ¨™</label>
            <input type="number" class="xCoord" value="123">
            <label>Yåº§æ¨™</label>
            <input type="number" class="yCoord" value="550">
            <label>å­—å‹å¤§å°</label>
            <input type="number" class="fontSize" value="39">
        </div>
        <input type="text" class="textInput" placeholder="è¼¸å…¥æ–‡å­—" value="èˆ‰è¡Œå¹´åº¦ï¼š113å­¸å¹´åº¦ç¬¬1å­¸æœŸ">
    </div>
    <div class="text-input">
        <label>ç¬¬3åˆ—æ–‡å­—</label>
        <div class="input-group">
            <label>Xåº§æ¨™</label>
            <input type="number" class="xCoord" value="123">
            <label>Yåº§æ¨™</label>
            <input type="number" class="yCoord" value="615">
            <label>å­—å‹å¤§å°</label>
            <input type="number" class="fontSize" value="39">
        </div>
        <input type="text" class="textInput" placeholder="è¼¸å…¥æ–‡å­—" value="åƒåŠ å­¸ç”Ÿï¼š103ç­ ç‹å¤§åŒ">
    </div>
    <div class="text-input">
        <label>ç¬¬4åˆ—æ–‡å­—</label>
        <div class="input-group">
            <label>Xåº§æ¨™</label>
            <input type="number" class="xCoord" value="123">
            <label>Yåº§æ¨™</label>
            <input type="number" class="yCoord" value="675">
            <label>å­—å‹å¤§å°</label>
            <input type="number" class="fontSize" value="39">
        </div>
        <input type="text" class="textInput" placeholder="è¼¸å…¥æ–‡å­—" value="è©•å®šæˆç¸¾ï¼šå…¨ç­ç¬¬1å">
    </div>
    <div class="text-input">
        <label>ç¬¬5åˆ—æ–‡å­—</label>
        <div class="input-group">
            <label>Xåº§æ¨™</label>
            <input type="number" class="xCoord" value="123">
            <label>Yåº§æ¨™</label>
            <input type="number" class="yCoord" value="740">
            <label>å­—å‹å¤§å°</label>
            <input type="number" class="fontSize" value="39">
        </div>
        <input type="text" class="textInput" placeholder="è¼¸å…¥æ–‡å­—" value="ç‰¹é ’æ­¤ç‹€ä»¥èŒ²é¼“å‹µ">
    </div>
    <div class="text-input">
        <label>ç¬¬6åˆ—æ–‡å­—</label>
        <div class="input-group">
            <label>Xåº§æ¨™</label>
            <input type="number" class="xCoord" value="123">
            <label>Yåº§æ¨™</label>
            <input type="number" class="yCoord" value="1060">
            <label>å­—å‹å¤§å°</label>
            <input type="number" class="fontSize" value="39">
        </div>
        <input type="text" class="textInput" placeholder="è¼¸å…¥æ–‡å­—" value="ä¸­è¯æ°‘åœ‹  113  å¹´  12 æœˆ 15   æ—¥">
    </div>

    <div class="button-group">
        <button id="exportPDF">ğŸ–¨ï¸ é–‹å•ŸPDFåˆ—å°</button>
        <button id="loadDemo">ğŸ–¼ï¸ è¼‰å…¥DEMOç¯„æœ¬</button>
        <button id="saveSettings">ğŸ’¾ å„²å­˜è¨­å®š</button>
        <button id="resetSettings">ğŸ”„ ä½¿ç”¨é è¨­è¨­å®š</button>
    </div>
</div>

<div id="preview">
    <div id="imagePreview"></div>
    <canvas id="canvas" width="1240" height="1754"></canvas>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
    const imageInput = document.getElementById('imageInput');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const imagePreview = document.getElementById('imagePreview');
    const textInputs = document.querySelectorAll('.textInput');
    const fontSelect = document.getElementById('fontSelect');

    let img = new Image();

    // é è¨­è¨­å®š
    const defaultSettings = [
        { text: "èˆ‰è¾¦é …ç›®ï¼šç¬¬ä¸€æ¬¡æ®µè€ƒ", x: 123, y: 490, size: 39 },
        { text: "èˆ‰è¡Œå¹´åº¦ï¼š113å­¸å¹´åº¦ç¬¬1å­¸æœŸ", x: 123, y: 550, size: 39 },
        { text: "åƒåŠ å­¸ç”Ÿï¼š103ç­ ç‹å¤§åŒ", x: 123, y: 615, size: 39 },
        { text: "è©•å®šæˆç¸¾ï¼šå…¨ç­ç¬¬1å", x: 123, y: 675, size: 39 },
        { text: "ç‰¹é ’æ­¤ç‹€ä»¥èŒ²é¼“å‹µ", x: 123, y: 740, size: 39 },
        { text: "ä¸­è¯æ°‘åœ‹  113 å¹´  12  æœˆ 15  æ—¥", x: 123, y: 1060, size: 39 }
    ];

    window.onload = function() {
        // å¾ localStorage è®€å–è¨­å®š
        let settings = JSON.parse(localStorage.getItem('certificateSettings')) || defaultSettings;
        
        // åˆå§‹åŒ–è¼¸å…¥æ¡†
        document.querySelectorAll('.text-input').forEach((textInput, index) => {
            if (settings[index]) {
                textInput.querySelector('.textInput').value = settings[index].text;
                textInput.querySelector('.xCoord').value = settings[index].x;
                textInput.querySelector('.yCoord').value = settings[index].y;
                textInput.querySelector('.fontSize').value = settings[index].size;
            }
        });
        
        drawText();
    };

    // æ›´æ–° localStorage
    function updateLocalStorage() {
        const updatedSettings = [];
        document.querySelectorAll('.text-input').forEach(textInput => {
            updatedSettings.push({
                text: textInput.querySelector('.textInput').value,
                x: parseInt(textInput.querySelector('.xCoord').value),
                y: parseInt(textInput.querySelector('.yCoord').value),
                size: parseInt(textInput.querySelector('.fontSize').value)
            });
        });
        localStorage.setItem('certificateSettings', JSON.stringify(updatedSettings));
        alert('è¨­å®šå·²æˆåŠŸå„²å­˜ï¼');
    }

    // å„²å­˜è¨­å®šæŒ‰éˆ•
    document.getElementById('saveSettings').addEventListener('click', function() {
        updateLocalStorage();
    });

    // ä½¿ç”¨é è¨­è¨­å®šæŒ‰éˆ•
    document.getElementById('resetSettings').addEventListener('click', function() {
        if (confirm('ç¢ºå®šè¦æ¢å¾©ç‚ºé è¨­è¨­å®šå—ï¼Ÿ')) {
            // é‡ç½®æ‰€æœ‰è¼¸å…¥æ¡†ç‚ºé è¨­å€¼
            document.querySelectorAll('.text-input').forEach((textInput, index) => {
                textInput.querySelector('.textInput').value = defaultSettings[index].text;
                textInput.querySelector('.xCoord').value = defaultSettings[index].x;
                textInput.querySelector('.yCoord').value = defaultSettings[index].y;
                textInput.querySelector('.fontSize').value = defaultSettings[index].size;
            });
            
            // å„²å­˜åˆ° localStorage
            localStorage.setItem('certificateSettings', JSON.stringify(defaultSettings));
            
            // é‡æ–°ç¹ªè£½æ–‡å­—
            drawText();
            
            alert('å·²æ¢å¾©ç‚ºé è¨­è¨­å®šï¼');
        }
    });

    imageInput.addEventListener('change', function() {
        const file = this.files[0];
        if (!file) return;
        
        const reader = new FileReader();
        reader.onload = function(e) {
            img.src = e.target.result;
            img.onload = function() {
                // è‡ªå‹•èª¿æ•´åœ–ç‰‡å¤§å°
                const aspectRatio = img.width / img.height;
                const targetWidth = 1240; // 150 DPI çš„ A4 å¯¬åº¦
                const targetHeight = 1754; // 150 DPI çš„ A4 é«˜åº¦
                const canvasAspectRatio = targetWidth / targetHeight;

                if (aspectRatio > canvasAspectRatio) {
                    // åœ–ç‰‡è¼ƒå¯¬ï¼Œä¾å¯¬åº¦èª¿æ•´
                    img.width = targetWidth;
                    img.height = targetWidth / aspectRatio;
                } else {
                    // åœ–ç‰‡è¼ƒé«˜ï¼Œä¾é«˜åº¦èª¿æ•´
                    img.height = targetHeight;
                    img.width = targetHeight * aspectRatio;
                }

                imagePreview.style.backgroundImage = `url(${e.target.result})`;
                imagePreview.style.backgroundSize = 'contain';
                imagePreview.style.backgroundRepeat = 'no-repeat';
                imagePreview.style.backgroundPosition = 'center';
                drawText(); // è¼‰å…¥åœ–ç‰‡å¾Œç¹ªè£½æ–‡å­—
            }
        }
        reader.readAsDataURL(file);
    });

    // ç•¶ä»»ä½•æ–‡å­—è¼¸å…¥æ¡†çš„å…§å®¹æ”¹è®Šæ™‚ï¼Œé‡æ–°ç¹ªè£½æ–‡å­—
    textInputs.forEach(input => {
        input.addEventListener('input', function() {
            drawText();
        });
    });

    // ç•¶ä»»ä½• XY åº§æ¨™æˆ–å­—å‹å¤§å°è¼¸å…¥æ¡†çš„å…§å®¹æ”¹è®Šæ™‚ï¼Œé‡æ–°ç¹ªè£½æ–‡å­—
    document.querySelectorAll('.xCoord, .yCoord, .fontSize').forEach(input => {
        input.addEventListener('input', function() {
            drawText();
        });
    });

    // ç•¶å­—é«”é¸æ“‡æ”¹è®Šæ™‚ï¼Œé‡æ–°ç¹ªè£½æ–‡å­—
    fontSelect.addEventListener('change', drawText);

    function drawText() {
        ctx.clearRect(0, 0, canvas.width, canvas.height); // æ¸…ç©ºç•«å¸ƒ

        const selectedFont = fontSelect.value;
        const textInputs = document.querySelectorAll('.text-input');
        textInputs.forEach((textInput) => {
            const x = parseInt(textInput.querySelector('.xCoord').value) || 0;
            const y = parseInt(textInput.querySelector('.yCoord').value) || 0;
            const size = parseInt(textInput.querySelector('.fontSize').value) || 20;
            const text = textInput.querySelector('.textInput').value;

            ctx.font = `${size * 1.4173}px "${selectedFont}"`; // å°‡å­—å‹å¤§å°è½‰æ›ç‚º 150 DPI çš„å¤§å°
            ctx.fillStyle = 'black';
            ctx.fillText(text, x * 1.4173, y * 1.4173); // å°‡åº§æ¨™è½‰æ›ç‚º 150 DPI çš„åº§æ¨™
        });
    }

    document.getElementById('exportPDF').addEventListener('click', function() {
        const { jsPDF } = window.jspdf; // ç¢ºä¿æ­£ç¢ºå¼•ç”¨ jsPDF
        const pdf = new jsPDF('p', 'mm', 'a4');
        const imgData = canvas.toDataURL('image/png');
        pdf.addImage(imgData, 'PNG', 0, 0, 210, 297);
        //pdf.save('çç‹€.pdf');
        // ç›´æ¥é–‹å•Ÿ PDF
        window.open(pdf.output('bloburl'), '_blank');
    });

    // DEMO æŒ‰éˆ•åŠŸèƒ½
    document.getElementById('loadDemo').addEventListener('click', function() {
        // è¼‰å…¥çç‹€ç¯„æœ¬ demoprize.jpg
        const demoImage = new Image();
        demoImage.src = 'demoprize.jpg';
        demoImage.onerror = function() {
            alert('ç„¡æ³•è¼‰å…¥DEMOç¯„æœ¬åœ–ç‰‡ï¼Œè«‹ç¢ºèª demoprize.jpg æª”æ¡ˆæ˜¯å¦å­˜åœ¨ï¼');
            // å¦‚æœæ‰¾ä¸åˆ°åœ–ç‰‡ï¼Œè‡³å°‘æ¸…é™¤ç¾æœ‰èƒŒæ™¯
            imagePreview.style.backgroundImage = 'none';
        };
        demoImage.onload = function() {
            const aspectRatio = demoImage.width / demoImage.height;
            const targetWidth = 1240; // 150 DPI çš„ A4 å¯¬åº¦
            const targetHeight = 1754; // 150 DPI çš„ A4 é«˜åº¦
            const canvasAspectRatio = targetWidth / targetHeight;

            if (aspectRatio > canvasAspectRatio) {
                // åœ–ç‰‡è¼ƒå¯¬ï¼Œä¾å¯¬åº¦èª¿æ•´
                demoImage.width = targetWidth;
                demoImage.height = targetWidth / aspectRatio;
            } else {
                // åœ–ç‰‡è¼ƒé«˜ï¼Œä¾é«˜åº¦èª¿æ•´
                demoImage.height = targetHeight;
                demoImage.width = targetHeight * aspectRatio;
            }

            imagePreview.style.backgroundImage = `url(${demoImage.src})`;
            imagePreview.style.backgroundSize = 'contain';
            imagePreview.style.backgroundRepeat = 'no-repeat';
            imagePreview.style.backgroundPosition = 'center';
            
            // åŒæ™‚ä¹Ÿæ›´æ–°é è¨­æ–‡å­—ï¼ˆå¦‚æœä½¿ç”¨è€…æƒ³è¦ï¼‰
            if (confirm('æ˜¯å¦åŒæ™‚è¼‰å…¥DEMOçš„é è¨­æ–‡å­—å…§å®¹ï¼Ÿ')) {
                document.querySelectorAll('.text-input').forEach((textInput, index) => {
                    textInput.querySelector('.textInput').value = defaultSettings[index].text;
                    textInput.querySelector('.xCoord').value = defaultSettings[index].x;
                    textInput.querySelector('.yCoord').value = defaultSettings[index].y;
                    textInput.querySelector('.fontSize').value = defaultSettings[index].size;
                });
                drawText();
            }
        }
    });

    // åœ¨é é¢é—œé–‰å‰è‡ªå‹•å„²å­˜è¨­å®š
    window.addEventListener('beforeunload', function() {
        updateLocalStorage();
    });
</script>
</body>
</html>